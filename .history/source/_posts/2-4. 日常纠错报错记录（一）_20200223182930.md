---
title: 日常纠错报错记录（第一篇）
date: 2018-05-29 17:00
categories:
  - 原创
  - 错误日志
tags:
  - 笔记
  - 纠错日志
---

## 001 Xshell 无法连接虚拟机

> 2017.12.26

- **问题描述：**
  12
  123
  1234

  **无法正确连接虚拟机**
  Linux 的 npm 服务可用但网页打不开、Xshell 无法连接虚拟机，linux 无法 ping 主机（ `connect: network is unreachable`）

- **存在问题：**
  ![1](../images/errlogs_01/1.png)
  尚不理解

- **解决方法：**

  （由车春旭解决）
  贴图：--

---

## 002 svg 图标的使用方式

> 2017.12.11

- **问题描述：**
  svg 图标的使用方式

- **使用方式：**
  示例：开发者中心 回到顶部 按钮
  [注意事项]：需要把`.svg`静态资源上传到`home/code/src/img/image/DevCenter/`下
  ![2](../images/errlogs_01/2.png)

## 003 为 D-Vault 开发者中心添加滚动条多次失败

> 2017.12.01

- **问题描述：**
  为 D-Vault 开发者中心添加滚动条多次失败

- **存在问题：**
  d-valut 中在通用 css 中设置了滚动条 `width=0`，所以所有页面默认不显示。开发者中心页面设置`width=10px`无效的原因是该页面布局采用了 `position:relative` 定位的方式，所以必须设置 `right:10px;` ，为滚动条留出空间。

- **解决方式：**
  为滚动条父元素设置 `right:10px;` ，再设置滚动条样式（关于滚动条样式设置，参见 http://blog.csdn.net/zh_rey/article/details/72473284 ）：
  ![3](../images/errlogs_01/3.png)

## 004 正则匹配文件后缀名

> 2017.11.27

- **问题描述：**
  正则匹配文件后缀名

- **解决方式：**
  `/\.js$/` -- 以 .js 结尾
  `/\.(jps|png)$/` -- 以 .jpg 或 .png 结尾

## 005 获取 url 中（或上传的文件）的文件名（去掉后缀名）

> 2017.11.20 16:00

- **问题描述：**
  获取 url 中（或上传的文件）的文件名（去掉后缀名）
- **存在问题：**
  文件的后缀名种类繁多，此处用正则表达式（`/\.(jpg|png|gif|...)/`）去匹配不合适，可直接使用`lastIndexOf('.')`等 API。
- **解决方式：**
  1. `split('/');` //将 url 分隔成数组，取最后一个元素；
  2. `arr.slice(0, array.lastIndexOf('.'));` //查找最后一个.，截取其前所有字符并返回。
     ![5](../images/errlogs_01/5.png)

## 006 通过 git 命令只拉取指定文件夹下的内容

> 2017.11.15 16:50

- **问题描述：**
  在拉取 git 远程仓库的代码时，可以通过 git 命令只拉取指定文件夹下的内容
- **存在问题：**
  如果只拉取 git 上某仓库的指定文件夹，如 leopard/engine/webui/dana/leopard，可以通过相关命令实现，但存在的问题是 无法在该目录下切换分支，它会默认使用 master 分支。所以，该思路不可行。

  命令：

  1. `git init`
  2. `git remote add -f origin "http://211.144.114.26:5081/trunk/leopard.git"`
  3. `git config core.sparsecheckout true`
  4. `echo "engine/webui/dana/leopard" >> .git/info/sparse-checkout`
  5. `git pull origin master`

  参考文章：http://blog.csdn.net/linlzk/article/details/49019787

## 007 无法打开页面问题

> 2017.11.15 14:39 **无法打开页面问题**

- **问题描述：**
  E 盘下共享文件夹`code/leopard`无法同步到 linux 开发环境下（`/home/...`），并且`192.168.1.221`节点无法打开页面（报`502 bad gateway`）

- **错误原因：**

  1. 在设置了共享文件夹（`e/code/leopard`）的方式之后，开发环境的代码包不再位于 linux 下的 `/home/` 中，而是位于 /`mnt/hgfs/code/leopard` 下。切记！
     所以并非无法实现同步，而是之前认为的位置是错误的。
  2. 502 的错误：apache 服务未打开。

- **解决方式：**
  该 502 错误不同于昨天遇到的 502：昨天报 502 是因为在文件上传提交 ajax 时，发送了错误的地址（默认发送了本地 host，即`window.location.host`，而是应该在测试的时候，发送`192.168.1.20`的地址，在提交代码的时候，再改回`window.location.host`）。
  ![7-1](../images/errlogs_01/7_1.png)

  打开 apache 服务：（至于 apache 服务为什么被关闭了，i d'ont know.）
  ![7-2](../images/errlogs_01/7_2.png)
  ![7-3](../images/errlogs_01/7_3.png)

## 008 开启 npm 服务失败问题

> 2018.01.11 12:20 **开启 npm 服务失败问题**

- **问题描述：**
  d-vault 项目在虚拟机 `/home/code/d-vault/webui` 目录下开启 npm 服务失败

- **错误原因：**
  目测很可能是因为该目录下 `node_modules` 包的问题
  ![8](../images/errlogs_01/8_1.png)

- **解决方式：**
  可以尝试将项目备份，然后重新将 `node_modules` 包拷贝一份替换

## 008-1 git push 推送失败问题

> 2018.01.29 14:10 **git push 推送失败问题**

- **问题描述：**
  `git push` 提交代码时，因 add 了新图片文件导致文件过大，无法推送。
  ![8-1](../images/errlogs_01/8_1_1.png)

- **错误原因：**
  （推测是新增文件无法连接到上海远程服务器）

- **解决方式：**
  方式一：使用 `git lfs push` 推送，无效；
  方式二：在重新执行 `git push` 之前，先执行：

```
    [root@localhost webui]# iptables -t nat -A OUTPUT -d 192.168.50.4 -j DNAT --to-destination 211.144.114.26
```

    再执行 `git push` ，成功。
    ![8-2](../images/errlogs_01/8_1_2.png)

## 009 使用 git push 命令时需反复输入用户名的问题

> 2018.01.29 14:22 **使用 git push 命令时需反复输入用户名的问题**

- **问题描述：**
  使用 `git pull` 或 `git push` 命令时每次都需要输入冗长的用户名和密码

- **错误原因：**
  在 `git clone "..."` 拉取代码库的时候，未将用户名和密码一起设置进去

- **解决方式：**
  使用 `git clone` 命令重新拉取代码库时将用户名和密码一起设置进去
  => `git clone http://username:password@giturl/xxx.git`

```javascript
  [root@localhost webui]# git lfs clone "http://wei.fanguang:datatom.com@211.144.114.26:5081/trunk/d-vault.git"
```

![9](../images/errlogs_01/9_1.png)

## 010 拉取源代码时图片未成功下载，导致本地图片无法打开，页面图片不显示

> 2018.02.01 15:00 **拉取源代码时图片未成功下载，导致本地图片无法打开，页面图片不显示**

- **问题描述：**
  `git clone`在拉取源代码时未能成功将图片大文件`pull`下来，于是跳过该过程，导致本地（`linux`下）图片无法正常显示

- **错误原因：**
  `lfs`问题。...

- **解决方式：**
  [**法一**]踩过两次雷区的一种方法：
  先删除本地（`linux`下）图片文件，再重新`download`远程文件。
  1. 使用 `rm -rf books` 命令删除`books`目录及其目录下所有图片；
  2. 使用 `git checkout -- books` 撤销删除操作，即重新下载已被删除的文件。但此处由于 `lfs` 的问题导致无法正常`download`。需要先执行 `iptables` 命令：

```javascript
  iptables -t nat -A OUTPUT -d 192.168.50.4 -j DNAT --to-destination 211.144.114.26 #后改为 192.168.50.2 、211.144.114.26:5088
  （iptables -t nat -F  && iptables -t nat -A OUTPUT -p tcp -d 192.168.50.2 --dport 80 -j DNAT --to 211.144.114.26:5088 ）  -- 张忠宝荐
```

再接着执行 `git checkout -- books` 命令，便可成功重新下载被删除文件。
![10-1](../images/errlogs_01/10_1.png)

[**法二**]（法一后来发现不再生效）：
进入到图片所在文件夹下，删除所有图片，再重新 `checkout` 撤回删除，便重新下载。

1. `cd img/images/DevCenter/Books`
2. `ll` #列出所有图片，或 `ls -l`
3. `rm -rf *` #删除所有图片
4. `git checkout -- *` #撤回删除，重新下载
   ![10-2](../images/errlogs_01/10_2.png)

[**法三**]（同法二）：
可在根目录下执行，也可在指定目录下执行操作：

1. 删除所有指定类型的文件

```javascript
  find . -name "*.png" -type f -print -exec rm -rf {} \;
```

![10-3](../images/errlogs_01/10_3.png)

2. 重新下载（即撤回删除操作）。若下载缓慢，可终止插入执行 `iptables` ...... 命令再重新 `checkout`
   `git checkout "*.png"` 或 `git checkout -- "*.png"`
   ![10-4](../images/errlogs_01/10_4.png)

## 011 多分支提交时失败报错的问题

> 2018.02.09 10:50 **多分支提交时失败报错的问题**

- **问题描述：**
  使用 `git cherry-pick` 指令进行多分支提交时报错失败，无法在当前分支提交另一分支已经提交的代码
  具体过程如下：

  1. 在 `master` 分支正常提交一次记录
  2. 切换到 `v3.5.2` 分支上（先`pull`代码），使用 `cherry-pick e7a58f2b` 在 `v3.5.2` 上提交 `master` 上的刚才的记录
  3. 在 `v3.5.2` 上 `git push` 推送代码，发现报错，推送失败。
     ![11-2](../images/errlogs_01/11_1.png)

- **错误原因：**
  尚不清晰，可能是冲突的原因

- **解决方式：**
  尚未整理出完整可行的方式，可尝试以下方法：
  ![11-2](../images/errlogs_01/11_2.png)

## 012 git pull 拉取代码时提示有错误（`.git/ORIG_HEAD`文件问题）

> 2018.03.06 11:11 **git pull 拉取代码时提示有错误（`.git/ORIG_HEAD`文件问题）**

- **问题描述：**
  在 `git pull` 拉取代码时提示错误，导致无法正常拉取。
  ![12-1](../images/errlogs_01/12_1.png)

- **错误原因：**
  参考：https://stackoverflow.com/questions/10570319/cannot-pull-git-cannot-resolve-reference-orig-head
  ![12-2](../images/errlogs_01/12_2.png)

- **解决方式：**
  在项目目录中找到 `ORIG_HEAD` 文件，删除
  1. `# find / -name ORIG_HEAD`
     `/home/code/d-vault/.git/ORIG_HEAD`
  2. `# rm -rf ORIG_HEAD`
  3. `# git pull` # 重新拉取，成功

## 013 linux 下 npm start 启动成功，但无法打开网页

> 2018.03.21 12:00 **linux 下 npm start 启动成功，但无法打开网页**

- **问题描述：**
  在 `d-vault` / `Dana4.0` 项目中开启 npm 服务（`npm start`）成功后，无法正常打开网页
  （`linux`在前几天重新创建过虚拟机，可能是相关配置未配置好？）
  ![13-1](../images/errlogs_01/13_1.png)

- **错误原因：**
  未关闭防火墙（车春旭解决认为）

- **解决方式：**
  关闭防火墙：
  `# systemctl stop firewalld`
  `# systemctl disable firewalld`
  ![13-2](../images/errlogs_01/13_2.png)

## 014 Dana4.0 中无法通过 js 操作 iframe 中的元素

> 2018.05.02 17:00 **Dana4.0 中无法通过 js 操作 iframe 中的元素**

- **问题描述：**
  解决方案模块中企图通过 js 获取`iframe`页面中的`dom`元素以更改其样式，多方尝试后失败

- **错误原因：**
  因此处`iframe`使用了其他链接的页面，所以这里存在跨域问题，导致暂无法跨域操作`dom`
  ![14-1](../images/errlogs_01/14_1.png)
  ![14-2](../images/errlogs_01/14_2.png)

- **解决方式：**
  无。暂放弃此需求。
  参考文章：知乎：js 怎么跨域获取 iframe 中的内容？https://www.zhihu.com/question/37185579

## 015 Dana4.0 在 beta2 分支中 git pull 报错无法进行

> 2018.05.15 12:00 **Dana4.0 在 beta2 分支中 git pull 报错无法进行**

- **问题描述：**
  dana 在本地创建了新分支 beta2 并推送到远程之后，再次在 beta2 分支上`git pull`时出现问题，无法继续`pull`
  ![15-1](../images/errlogs_01/15_1.png)

- **错误原因：**
  暂未知

- **解决方式：**
  执行上图红色部分命令，为`beta2` 分支创建跟踪信息

```javascript
  $ git branch --set-upstream-to=origin/beta2 beta2
```

![15-2](../images/errlogs_01/15_2.png)
重新 `git pull` ，成功。

## 016 Dana4.0 beta2 中模拟页面长时间无操作后用户登出功能

> 2018.05.29 17:00 **Dana4.0 beta2 中模拟页面长时间无操作后用户登出功能**

- **解决方式：**
  **_思路一：_**

  1. 登陆成功时将当前时间 `currentTime` 存储到 `localStorage` ；
  2. 页面在 `componentDidMount` 中（即刷新）时，重新获取当前时间 `currentTime` ，与 `localStorage` 中的 `loginTime` 作比较，超出 `duration` 则登出。
     缺点：效果被写死，无法实现用户无操作才能登出，只能实现网页每隔 `duration` 后强制登出。否决！
     ![16-1](../images/errlogs_01/16_1.png)

  **_思路二：_**

  1. 记录鼠标最后一次操作 `mousemove` 时的时间 `lastMove；`
  2. 每隔 5 秒检查当前时间 `currentTime` 与 `lastMove` 的差值，超出 `duration` 则登出；
  3. 若新页面暂无鼠标操作，则 `lastMove` 默认取当前时间。
     备注：这种方式可以解决思路一存在的问题，实现页面长时间无操作后用户登出功能。但是由于频繁的检查操作，可能会降低性能。暂可用。
     ![16-2](../images/errlogs_01/16_2.png)
