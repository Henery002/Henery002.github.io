<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="我心思慕你，如鹿思慕溪">
<meta property="og:type" content="website">
<meta property="og:title" content="Henery 的博客">
<meta property="og:url" content="https:&#x2F;&#x2F;henery002.github.io&#x2F;index.html">
<meta property="og:site_name" content="Henery 的博客">
<meta property="og:description" content="我心思慕你，如鹿思慕溪">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"right","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://henery002.github.io/"/>





  <title>Henery 的博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Henery 的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">心路历程</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-schedule">
          <a href="/schedule/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-calendar"></i> <br />
            
            日程表
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            站点地图
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://henery002.github.io/2019/06/05/Refs%E8%BD%AC%E5%8F%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="魏范光">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/IMG_20190808_014018.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Henery 的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/06/05/Refs%E8%BD%AC%E5%8F%91/" itemprop="url">Refs转发</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-06-05T10:00:00+08:00">
                2019-06-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>React中的refs提供了一种访问 render() 方法中创建的React 元素的方法。虽然React的使用思想是通过传入 props 或 state 进行状态管理进而重新渲染组件，不提倡强行修改DOM元素，但在某些场景和需求下，访问DOM节点不可避免，是从DOM元素读取数据的好方法。</p>
<h2 id="在React中使用Refs的四种方式"><a href="#在React中使用Refs的四种方式" class="headerlink" title="在React中使用Refs的四种方式"></a>在React中使用Refs的四种方式</h2><h3 id="String-refs"><a href="#String-refs" class="headerlink" title="String refs"></a>String refs</h3><p>ref的字符串属性。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&lt;input type=<span class="string">"text"</span> ref=<span class="string">"textInput"</span> /&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// 然后在组件中可以通过 this.refs.textInput.value 获取到该DOM节点的值</span></span></pre></td></tr></table></figure>

<p>这种设置refs的方式已经过时。在配置了eslint的项目中使用时将会抛出错误提示，应该避免使用这个废弃的API。</p>
<h3 id="回调引用（callback-refs）"><a href="#回调引用（callback-refs）" class="headerlink" title="回调引用（callback refs）"></a>回调引用（callback refs）</h3><p><strong><u>给DOM元素添加ref属性</u></strong></p>
<p>在项目中常用的方式是refs回调。即为ref属性设置回调函数，当设置ref时，React会调用这个函数，并将element作为第一个参数传递给该函数。</p>
<p>贴一个常用的案例。该示例用于获取input标签的文本值，使用回调函数的方式引入。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomTextInput</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">super</span>(props);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">this</span>.textInput = <span class="literal">null</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">this</span>.setTextInputRef = <span class="function"><span class="params">element</span> =&gt;</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">      <span class="keyword">this</span>.textInput = element; <span class="comment">// 将element赋值给 this.textInput</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    &#125;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">  &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">  handleSubmit = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">    e.preventDefault();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.textInput.value);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">  &#125;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">  render() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">return</span> (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">      &lt;div&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">        &lt;input type=<span class="string">"text"</span> ref=&#123;<span class="keyword">this</span>.setTextInputRef&#125; /&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">        <span class="comment">// 或者写成</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">        &lt;input type=<span class="string">"text"</span> ref=&#123;ele =&gt; <span class="keyword">this</span>.eleInput = ele&#125;&gt; <span class="comment">// ele 即指向当前input元素</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">        &lt;button onClick=&#123;e =&gt; <span class="keyword">this</span>.handleSubmit(e)&#125;&gt;提交&lt;<span class="regexp">/button&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">    );</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">  &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>当组件被挂载时React会将这个DOM元素传递给 ref 的回调函数，element作为DOM元素的实例被赋值给 this.textInput。</p>
<p><strong><u>给类组件添加ref属性</u></strong></p>
<p>如果给 class 声明的组件添加 ref 属性，则 ref 回调的参数将指向已经加载的该组件的实例。这种方式区别于下面将要讲到的函数式组件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">  render() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> /&gt;</span>;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="xml">  &#125;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="xml">&#125;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="xml">class Fn extentds React.Comonent &#123;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="xml">  render() &#123;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    return &lt;Foo ref=&#123;ele =&gt; &#123; this.componentEle = ele; console.log(ele) &#125;&#125; /&gt;;   // ele指向当前组件的实例</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">  &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p><strong><u>refs与函数式组件</u></strong></p>
<p>ref属性不能用在函数式声明的组件上，因为函数式组件不能被实例化。如以下ref赋值方式无效并且会报错：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">InputText</span>(<span class="params"></span>) </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">  <span class="keyword">return</span> (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    &lt;div&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">      &lt;input type=<span class="string">"text"</span>/&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    &lt;<span class="regexp">/div&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">  );</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">&#125;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="regexp"></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">class MyComponent extends React.Component &#123;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">  render() &#123;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">    /</span><span class="regexp">/ ref 无效且报错</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">    return &lt;InputText ref = &#123;el =&gt; &#123;this.componEle = el&#125;&#125;/</span>&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">  &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>但是在函数式组件内部依然可以使用ref属性。</p>
<h3 id="React-createRef"><a href="#React-createRef" class="headerlink" title="React.createRef()"></a>React.createRef()</h3><p>React提供了creatRef()函数来创建Refs，并通过该方法将ref属性附加到React组件的DOM元素上。</p>
<p>比如，我们在组件的构造函数中创建一个ref实例，使其在整个组件内可用，并将其赋值给 this.firstRef，然后在render()方法内部，将创建的ref示例传递给HTML元素。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">super</span>(props);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">this</span>.firstRef = React.createRef();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">  &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">  <span class="comment">// ...</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">  render() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">&#123;this.firstRef&#125;</span> /&gt;</span>;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="xml">  &#125;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="xml">&#125;</span></span></pre></td></tr></table></figure>

<p>通过这种方式创建ref，我们可以重构一些现有的业务场景。</p>
<p>来看一个例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomTextInput</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">super</span>(props);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">// 创建一个ref实例</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">this</span>.textInput = React.createRef();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">  &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">  focusTextInput() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">// 当 ref 属性被render()方法中的HTML元素使用时，上述创建的ref实例会接收来自底层DOM元素的 current 值</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.textInput.current.value);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">this</span>.textInput.current.focus();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">  &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">  render() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">// 将在构造函数中创建的ref示例传递到 input 组件的 ref 属性上</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">return</span> (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">      &lt;div&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">        &lt;input type=<span class="string">"text"</span> ref=&#123;<span class="keyword">this</span>.textInput&#125; /&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">        &lt;input</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">          type=<span class="string">"button"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">          value=<span class="string">"Focus the text input"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">          onClick=&#123;<span class="keyword">this</span>.focusTextInput&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">        /&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">      &lt;<span class="regexp">/div&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">    );</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">  &#125;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">&#125;</span></span></pre></td></tr></table></figure>

<p>这里有一个 current 属性，它就是input DOM 元素对象本身（是一个DOM对象），所以，要获取input标签的实际值（或者其方法属性），必须要使用 this.textInput.current.value 方式。</p>
<p>React.createRef 主要是结合 React.forwardRef 方法实现 refs 的转发，来看下面的例子。</p>
<h3 id="转发refs（Forwarding-refs）"><a href="#转发refs（Forwarding-refs）" class="headerlink" title="转发refs（Forwarding refs）"></a>转发refs（Forwarding refs）</h3><p>React提供的 Ref forwarding 方案用来将 ref 通过组件传递给其子节点。这种场景对于可复用组件库和高阶组件很有用。</p>
<p>也就是说，可以使用 React.forwardRef 函数将 ref 转发到组件中，Ref forwarding 允许组件接收一个 ref，并将它向下传递 / 转发（用来点题）给子组件。</p>
<p>一个栗子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> TextInput = React.forwardRef(<span class="function">(<span class="params">props, ref</span>) =&gt;</span> (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">  &lt;input type=<span class="string">"text"</span> placeholder=<span class="string">"请输入表名"</span> ref=&#123;ref&#125; /&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">));</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> inputRef = React.createRef();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomTextInput</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">   handleSave = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    <span class="built_in">console</span>.log(inputRef.current.value);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">  &#125;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">  render() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">return</span> (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">      &lt;div&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">        &lt;TextInput ref=&#123;inputRef&#125; /&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">        &lt;button onClick=&#123;<span class="keyword">this</span>.handleSave&#125;&gt;保存&lt;<span class="regexp">/button&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">    );</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">  &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>总结起来说，就是：</p>
<ol>
<li>使用 React.createRef() 创建一个 ref 实例（inputRef）；</li>
<li>将 ref 实例指定给组件（TextInput）的 ref 属性 ;</li>
<li>React.forwardRef()方法将 ref 实例作为其回调函数的第二个参数向下转发给底层DOM组件（<strong><code>&lt;input ref={ref} /&gt;</code></strong>）；</li>
<li>在外层组件中能够通过 current对象访问DOM节点值。</li>
</ol>
<blockquote>
<p>注：这里的外层组件是 CustomTextInput 相对于 InputText 而言。</p>
</blockquote>
<h2 id="在高阶组件中转发Refs"><a href="#在高阶组件中转发Refs" class="headerlink" title="在高阶组件中转发Refs"></a>在高阶组件中转发Refs</h2><p>另外在React Refs的官方文档中还讲到了在高阶组件（HOC）中转发 refs，这里也顺便了解一下。不过我目前还没有在项目中实际使用过，但对于高阶组件而言很有用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Input  = <span class="function">(<span class="params">InputComponent</span>) =&gt;</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">  <span class="keyword">const</span> forwardRef = <span class="function">(<span class="params">props, ref</span>) =&gt;</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">const</span> onChange = <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(ref.current.value);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">return</span> (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">      &lt;InputComponent</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">        forwardedRef=&#123;ref&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">        onChange=&#123;onChange&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">        &#123;...props&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">      /&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    );</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">  &#125;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">  <span class="keyword">return</span> React.forwardRef(forwardRef);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">&#125;;</span></pre></td></tr></table></figure>

<p>这个 Input 高阶组件接收一个 InputComponent 组件作为参数，forwardRef 函数会返回 InputComponent，函数中包含的 ref 参数是由 React.forwardRef() 方法创建的。<strong>这个高阶组件最终会把包装好的组件作为值返回。</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// 待包装子组件 InputCompoment</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将 forwardedRef 下发给 ref 属性，在render()方法中，input输入框就会接收到这个 ref</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> TextInput = <span class="function">(<span class="params">&#123; forwardedRef, children, ...rest &#125;</span>) =&gt;</span> (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">  &lt;div&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    &lt;input ref=&#123;forwardedRef&#125; &#123;...rest&#125; /&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    &#123;children&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">  &lt;<span class="regexp">/div&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">);</span></span></pre></td></tr></table></figure>

<p>可以这样使用这个高阶组件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将 TextInput 传入 Input 高阶组件，会返回一个 InputField component</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> InputField = Input(TextInput);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomTextInput</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">  render() &#123;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">// 依然使用该方法创建一个 ref 实例，并作为参数传递给 InputFIeld 组</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">const</span> inputRef = React.createRef();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">InputField</span> <span class="attr">ref</span>=<span class="string">&#123;inputRef&#125;</span> /&gt;</span>;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="xml">  &#125;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="xml">&#125;</span></span></pre></td></tr></table></figure>

<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>refs的实际项目中的使用场景并不是很多，也不是必须要用到的技术点，只是有时候在特定场景下使用将会便于开发（如操作input控件的值与状态改变、触发某些动画等）。</p>
<p>这里只是作为技术复盘，盘点一下React Refs的使用方式，温故而知新。</p>
<h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><ol>
<li>React中文文档 - Refs转发</li>
<li>深入理解React虚拟DOM</li>
<li>React中的Refs &amp; DOM</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://henery002.github.io/2019/04/17/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="魏范光">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/IMG_20190808_014018.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Henery 的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/17/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91/" itemprop="url">微信小程序开发</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-17T12:01:05+08:00">
                2019-04-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本文将结合小程序示例项目源码，通过在手机微信客户端实时编译预览，交流学习小程序开发的流程、架构、语法与开放API等内容。</p>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><blockquote>
<p>小程序（Mini Program）是一种新的开放能力，是一种不需要下载安装即可使用的应用，它实现了应用“触手可及”的梦想，用户扫一扫或搜一下即可打开应用。</p>
</blockquote>
<h3 id="小程序发展史"><a href="#小程序发展史" class="headerlink" title="小程序发展史"></a>小程序发展史</h3><p>2016年9月21日，微信小程序开启内测。腾讯云上线微信小程序解决方案，提供小程序在云端服务器的技术方案。</p>
<p>2017年1月9日，张小龙在2017微信公开课上宣布小程序正式上线。</p>
<p>2017年3月，小程序面向个人开发者开放注册。</p>
<p>2017年12月28日，微信小游戏上线 – 全民娱乐的微信《跳一跳》。</p>
<p>2018年，微信小程序陆续更新升级功能，其中包括支持自定义小程序菜单栏等区域的页面风格、开放“附近小程序”、支持小程序投放广告、开发“功能直达”（微信 – 附近的商家）、开发者工具支持真机调试等。</p>
<p>……</p>
<p>小程序迭代更新的两年多时间，无论从社区生态、技术架构、云端开发，还是开发者工具等方面来看，都有了质的飞跃，也让普通开发者能够快速上手，定制企业级或者属于个人的小程序。</p>
<h3 id="小程序与公众号"><a href="#小程序与公众号" class="headerlink" title="小程序与公众号"></a>小程序与公众号</h3><p>微信公众号开发者需要懂得一门服务器端语言（如php、java、.net、nodejs）而对于前端开发人员来说，上手微信小程序开发没有任何门槛。</p>
<p>有关小程序前世今生的文案内容可以自行百度，不再赘述。</p>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>小程序开发流程主要分为四步：</p>
<ul>
<li>账号注册</li>
<li>信息完善</li>
<li>开发</li>
<li>提交审核与发布</li>
</ul>
<h3 id="申请账号"><a href="#申请账号" class="headerlink" title="申请账号"></a>申请账号</h3><ol>
<li>在<a href="mp.weixin.qq.com">微信公众平台</a>注册小程序账号，填写登记信息。图片: <a href="https://uploader.shimo.im/f/7B0Pe6yxw1wyUfGH.png" target="_blank" rel="noopener">https://uploader.shimo.im/f/7B0Pe6yxw1wyUfGH.png</a></li>
</ol>
<blockquote>
<p>注：</p>
<ol>
<li>用于注册的邮箱账必须未被微信公众平台注册，未被微信开放平台注册、未被个人微信号绑定。</li>
<li>每个邮箱只能申请一个小程序账号。</li>
</ol>
</blockquote>
<ol start="2">
<li>注册后登陆微信公众平台，需要使用微信扫码验证身份后登陆。图片: <a href="https://uploader.shimo.im/f/yuzq9dX44s4gY1nK.png" target="_blank" rel="noopener">https://uploader.shimo.im/f/yuzq9dX44s4gY1nK.png</a></li>
</ol>
<blockquote>
<p>注：登录的时候需要使用小程序身份的账号，这里区别于微信公众号身份的账号。</p>
</blockquote>
<ol start="3">
<li><p>完善小程序主体的相关设置信息。图片: <a href="https://uploader.shimo.im/f/UCtEgmTncRY7GrK1.png" target="_blank" rel="noopener">https://uploader.shimo.im/f/UCtEgmTncRY7GrK1.png</a><br>每个小程序都拥有一个AppID，作为小程序的唯一标识。这个AppID可以用来在微信公众平台的其他身份账号中关联你已发布的微信小程序，或者在微信中搜索你的小程序。</p>
</li>
<li><p>在提交审核与发布环节，需要为小程序配置页面功能。图片: <a href="https://uploader.shimo.im/f/Fw1D2pZs8poTLFmI.png图片" target="_blank" rel="noopener">https://uploader.shimo.im/f/Fw1D2pZs8poTLFmI.png图片</a>: <a href="https://uploader.shimo.im/f/zj0bmvTDfzUH3klK.png" target="_blank" rel="noopener">https://uploader.shimo.im/f/zj0bmvTDfzUH3klK.png</a></p>
</li>
</ol>
<h3 id="安装开发者工具"><a href="#安装开发者工具" class="headerlink" title="安装开发者工具"></a>安装开发者工具</h3><p>在<a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html?t=19041921" target="_blank" rel="noopener">开发者工具</a>下载页面，选择下载版本。<br>图片: <a href="https://uploader.shimo.im/f/b71HNIfnBIMCZvoo.png" target="_blank" rel="noopener">https://uploader.shimo.im/f/b71HNIfnBIMCZvoo.png</a></p>
<h3 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h3><p>开发者可以选择导入既有项目，也可以选择创建新项目。</p>
<p>创建新项目时，需要填入申请小程序账号时生成的AppID。如果没有AppID，也可以使用测试号体验小程序的开发，只不过这种模式下很多功能的使用将会受到限制，比如无法使用云服务。</p>
<p>开发者工具在近两年来不断的更新中，逐渐集成了一整套开发流程完备的架构，包括模拟器（界面）、编辑器（IDE）、调试器（控制台），同时支持版本控制、二维码编译、实时编译等，极大方便了开发者的开发体验。</p>
<p>初始化项目会生成一套项目配置文件，下面会逐一介绍各个模块配置文件的主要配置方式及作用。<br>图片: <a href="https://uploader.shimo.im/f/nfzxl52ExoIHBJZD.png" target="_blank" rel="noopener">https://uploader.shimo.im/f/nfzxl52ExoIHBJZD.png</a></p>
<h2 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h2><p>小程序中原生组件的使用方式和html相似，也有着相似的属性。这里只列出原生组件的名称，相关使用方式、属性可以自行查阅开发者文档。</p>
<h3 id="基础组件（native-component）"><a href="#基础组件（native-component）" class="headerlink" title="基础组件（native-component）"></a>基础组件（native-component）</h3><ul>
<li>视图容器</li>
</ul>
<ol>
<li>cover-image             图片容器</li>
<li>cover-view</li>
<li>movable-area</li>
<li>movable-view</li>
<li>scroll-view</li>
<li>swiper                  滑块视图容器</li>
<li>swiper-item</li>
<li>view                    视图容器</li>
</ol>
<ul>
<li>基础内容</li>
</ul>
<ol>
<li>icon</li>
<li>progress</li>
<li>rich-text</li>
<li>text</li>
</ol>
<ul>
<li>表单组件</li>
</ul>
<ol>
<li>button</li>
<li>checkbox</li>
<li>checkbox-group</li>
<li>form</li>
<li>input</li>
<li>label</li>
<li>picker</li>
<li>picker-view</li>
<li>picker-view-column</li>
<li>radio</li>
<li>radio-group</li>
<li>slider</li>
<li>switch</li>
<li>textarea</li>
</ol>
<ul>
<li>导航</li>
</ul>
<ol>
<li>functional-page-navigator</li>
<li>navigator                    页面链接</li>
</ol>
<ul>
<li>媒体组件</li>
</ul>
<ol>
<li>audio</li>
<li>camera</li>
<li>image</li>
<li>live-player                  实时音视频播放</li>
<li>live-pusher                  实时音视频录制</li>
<li>video</li>
</ol>
<ul>
<li>map地图API</li>
</ul>
<ol>
<li>map</li>
<li>canvas画布</li>
<li>canvas</li>
</ol>
<ul>
<li>其他</li>
</ul>
<ol>
<li>add                           Banner广告</li>
<li>open-data                     用于展示微信开放的数据</li>
<li>……</li>
</ol>
<h3 id="自定义组件（custom-component）"><a href="#自定义组件（custom-component）" class="headerlink" title="自定义组件（custom-component）"></a>自定义组件（custom-component）</h3><p>我们也可以将页面内的功能模块抽象成自定义组件，以便在不同的页面中重复使用，或者将复杂的页面拆分成多个低耦合的模块，有助于代码维护。</p>
<p>这一点类似于 React 的组件化思想。其使用方法也和基础组件（即原生组件）非常相似。限于篇幅的原因，这里不多做描述，查看更多信息，请移步 自定义组件 。</p>
<h2 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h2><h3 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h3><p>以创建一个具备云开发功能的QuickStart项目为例：</p>
<p>小程序包含一个描述整体程序的 app 和多个描述各自页面的 page。</p>
<p>一个小程序的主体部分由三个文件组成，他们必须放置在项目根目录。</p>
<ol>
<li>app.js</li>
<li>app.json</li>
<li>app.wxss</li>
</ol>
<p>每个小程序页面模块有四个文件构成：</p>
<ol>
<li>js</li>
<li>json</li>
<li>wxml</li>
<li>wxss</li>
</ol>
<blockquote>
<p>注意：为了减少开发者进行复杂冗余的配置项，描述页面模块的四个文件必须具有相同的路径与名称<br>图片: <a href="https://uploader.shimo.im/f/kVCCn9TdvXcQaOpV.png" target="_blank" rel="noopener">https://uploader.shimo.im/f/kVCCn9TdvXcQaOpV.png</a></p>
</blockquote>
<h3 id="代码构成"><a href="#代码构成" class="headerlink" title="代码构成"></a>代码构成</h3><p>在上面创建的项目中，可以看到有以下几种类型的文件：</p>
<ol>
<li><p>.json，<strong>JSON配置文件</strong></p>
<ol>
<li><p>app.json是当前小程序的全局配置文件。主要配置小程序的所有页面路由、页面样式、底部Tab切换等。主要配置项有 pages、window、tabBar、sitemapLocation等字段，具体作用将结合代码讲解。<br>图片: <a href="https://uploader.shimo.im/f/ZtvNpG3eUBILTfan.png" target="_blank" rel="noopener">https://uploader.shimo.im/f/ZtvNpG3eUBILTfan.png</a></p>
</li>
<li><p>project.config.json是开发者工具的个性化配置。开发者可以针对自己的喜好对开发工具做一些界面样式、编译等的配置。</p>
</li>
<li><p>页面组件中的page.json，作用和 app.json 类似。app.json用来配置小程序全局的一些样式风格色调，但当开发者想要在某模块页面中设置自定义风格时，就可以通过 page.json 配置该模块页面的一些属性，用以覆盖改写全局配置属性。</p>
</li>
</ol>
</li>
<li><p>.wxml，<strong>WXML模板文件</strong><br> 作用、语法类同于HTML，但原生标签不同于HTML。微信小程序有自己专属的原生标签、标签属性以及js表达式语法，后面的章节将会详细介绍。</p>
</li>
<li><p>.wxss，<strong>WXSS样式文件</strong><br>同css样式文件。但小程序新增了尺寸单位 rpx。开发者不在需要针对手机设备屏幕的不同宽度做一些复杂换算，这些工作将交由小程序底层来做。<br>wxss有全局样式和局部样式的概念，其用法和上面讲到的 app.json / page.json 的区别与用法相同。</p>
</li>
<li><p>.js，<strong>JS脚本文件</strong><br>开发者还可以利用小程序提供的丰富的API，开发一些常用的业务场景，如获取用户信息、本地存储、微信支付、生成小程序吗、扫描二维码等等。<br>图片: <a href="https://uploader.shimo.im/f/NncRKZ8KIcwRa3fh.png" target="_blank" rel="noopener">https://uploader.shimo.im/f/NncRKZ8KIcwRa3fh.png</a></p>
</li>
</ol>
<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><ul>
<li><p><strong>全局配置</strong><br>app.json，以小程序示例项目代码为例：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">  <span class="attr">"pages"</span>: [</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="string">"page/component/index"</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="string">"page/component/pages/view/view"</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    <span class="string">"page/cloud/pages/scf-storage/scf-storage"</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">  ],</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">  <span class="attr">"window"</span>: &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    <span class="attr">"navigationBarTextStyle"</span>: <span class="string">"black"</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    <span class="attr">"navigationBarTitleText"</span>: <span class="string">"演示"</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    <span class="attr">"navigationBarBackgroundColor"</span>: <span class="string">"#F8F8F8"</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">    <span class="attr">"backgroundColor"</span>: <span class="string">"#F8F8F8"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">  &#125;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">  <span class="attr">"tabBar"</span>: &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">    <span class="attr">"color"</span>: <span class="string">"#7A7E83"</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">    <span class="attr">"selectedColor"</span>: <span class="string">"#3cc51f"</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">    <span class="attr">"borderStyle"</span>: <span class="string">"black"</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">    <span class="attr">"backgroundColor"</span>: <span class="string">"#ffffff"</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">    <span class="attr">"list"</span>: [</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">      &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">        <span class="attr">"pagePath"</span>: <span class="string">"page/component/index"</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">        <span class="attr">"iconPath"</span>: <span class="string">"image/icon_component.png"</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">        <span class="attr">"selectedIconPath"</span>: <span class="string">"image/icon_component_HL.png"</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">        <span class="attr">"text"</span>: <span class="string">"组件"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">      &#125;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">      &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">        <span class="attr">"pagePath"</span>: <span class="string">"page/API/index"</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line">        <span class="attr">"iconPath"</span>: <span class="string">"image/icon_API.png"</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line">        <span class="attr">"selectedIconPath"</span>: <span class="string">"image/icon_API_HL.png"</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line">        <span class="attr">"text"</span>: <span class="string">"接口"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line">      &#125;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line">      &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line">        <span class="attr">"pagePath"</span>: <span class="string">"page/cloud/index"</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line">        <span class="attr">"iconPath"</span>: <span class="string">"image/icon_cloud.png"</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">34</span></pre></td><td class="code"><pre><span class="line">        <span class="attr">"selectedIconPath"</span>: <span class="string">"image/icon_cloud_HL.png"</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">35</span></pre></td><td class="code"><pre><span class="line">        <span class="attr">"text"</span>: <span class="string">"云开发"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">36</span></pre></td><td class="code"><pre><span class="line">      &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">37</span></pre></td><td class="code"><pre><span class="line">    ]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">38</span></pre></td><td class="code"><pre><span class="line">  &#125;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">39</span></pre></td><td class="code"><pre><span class="line">  <span class="attr">"networkTimeout"</span>: &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">40</span></pre></td><td class="code"><pre><span class="line">    <span class="attr">"request"</span>: <span class="number">10000</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">41</span></pre></td><td class="code"><pre><span class="line">    <span class="attr">"uploadFile"</span>: <span class="number">10000</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">42</span></pre></td><td class="code"><pre><span class="line">    <span class="attr">"downloadFile"</span>: <span class="number">10000</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">43</span></pre></td><td class="code"><pre><span class="line">  &#125;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">44</span></pre></td><td class="code"><pre><span class="line">  <span class="attr">"cloud"</span>: <span class="literal">true</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">45</span></pre></td><td class="code"><pre><span class="line">  <span class="attr">"sitemapLocation"</span>: <span class="string">"sitemap.json"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">46</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>
</li>
<li><p><strong>页面配置</strong><br>page/index/index.json，页面模块配置项：</p>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// /page/index页面的json配置项（json中不支持注释）</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">  <span class="attr">"navigationBarTitleText"</span>: <span class="string">"小程序官方组件展示"</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">  <span class="attr">"navigationBarBackgroundColor"</span>: <span class="string">"#ffffff"</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">  <span class="attr">"navigationBarTextStyle"</span>: <span class="string">"black"</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">  <span class="attr">"backgroundColor"</span>: <span class="string">"#eeeeee"</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">  <span class="attr">"backgroundTextStyle"</span>: <span class="string">"light"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<ul>
<li><strong>sitemap配置</strong><br>跟目录下的 sitemap.json 文件用来配置小程序及其页面是否允许在微信内被索引。<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">  <span class="attr">"desc"</span>: <span class="string">"some description info..."</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">  <span class="attr">"rules"</span>: [&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">      <span class="attr">"action"</span>: <span class="string">"allow"</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    <span class="attr">"page"</span>: <span class="string">"*"</span>          <span class="comment">// 表示所有页面都可以被索引</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">  &#125;]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="运行机制（逻辑层）"><a href="#运行机制（逻辑层）" class="headerlink" title="运行机制（逻辑层）"></a>运行机制（逻辑层）</h3><p>小程序在原有JavaScript的基础上扩展了部分功能，以方便小程序的开发：</p>
<ol>
<li>增加 App 和 Page 方法，进行小程序注册和页面注册。</li>
<li>增加 getApp 和 getCurrentPages 方法，分别用来获取 App 实例和当前页面栈。</li>
<li>增加API。</li>
<li>支持模块化。</li>
</ol>
<blockquote>
<p>注意：小程序框架的逻辑层并非运行在浏览器中，所以js在浏览器端的一些特性将无法使用，如 window、document等。</p>
</blockquote>
<ul>
<li><strong>注册小程序</strong></li>
</ul>
<p>每一个小程序都需要在全局 app.js 中调用 App 方法注册小程序实例，并绑定生命周期回调函数、错误监听和页面不存在监听函数等。</p>
<p>App 方法只能在 app.js 中调用有且仅有一次，这个实例是全部页面共享的。开发者可以在页面模块中<strong>通过 getApp 方法获取到全局唯一的这个实例</strong>，并去调用在实例上注册或声明的函数或变量。</p>
<p>参数是一个 Object 对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// App()</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">App(&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">  onLaunch(options) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">// Do something initial when launch.</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">  &#125;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">  onShow(options) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">// Do something when show.</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">  &#125;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">  onHide() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">// Do something when hide.</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">  &#125;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">  onError(msg) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">    <span class="built_in">console</span>.log(msg)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">  &#125;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">  globalData: <span class="string">'some datas'</span>,        <span class="comment">// 用于自定义的变量或函数</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">&#125;)</span></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// getApp()</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// page/index/index.js</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> appInstance = getApp();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(appInstance.globalData);    <span class="comment">// some datas</span></span></pre></td></tr></table></figure>

<ul>
<li><strong>注册页面</strong></li>
</ul>
<p>每个页面模块都需要在对应的 js文件中调用 Page 方法注册页面实例，指定页面初始化数据、生命周期回调、事件处理函数等。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">Page(&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">  data: &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    text: <span class="string">'This is page data.'</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">  &#125;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">  onLoad(options) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">// Do some initialize when page load.</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">  &#125;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">  onReady() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">// Do something when page ready.</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">  &#125;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">  onShow() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">// Do something when page show.</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">  &#125;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">  onHide() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">// Do something when page hide.</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">  &#125;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">  onUnload() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">// Do something when page close.</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">  &#125;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">  onPullDownRefresh() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">// Do something when pull down.</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">  &#125;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">  onPageScroll() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">// Do something when page scroll</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">  &#125;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">  onResize() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">// Do something when page resize</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line">  &#125;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line">  onTabItemTap(item) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line">    <span class="built_in">console</span>.log(item.index)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line">    <span class="built_in">console</span>.log(item.pagePath)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line">    <span class="built_in">console</span>.log(item.text)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line">  &#125;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">34</span></pre></td><td class="code"><pre><span class="line">&#125;)</span></pre></td></tr></table></figure>

<ul>
<li><p><strong>小程序生命周期</strong><br>见上例代码部分。</p>
</li>
<li><p><strong>页面路由</strong><br>小程序的路由跳转方式一般包括：初始化、重定向、返回、Tab切换、重启动。我们可以直接参考开发者文档对页面路由触发方式的定义：</p>
<p>路由跳转的实例方法参见：<br>小程序示例项目代码 /page/pages/navigator/navigator.js 。<br>图片: <a href="https://uploader.shimo.im/f/Ls2rwgvrx5sCJ87P.png" target="_blank" rel="noopener">https://uploader.shimo.im/f/Ls2rwgvrx5sCJ87P.png</a></p>
</li>
</ul>
<h3 id="WXML语法（视图层）"><a href="#WXML语法（视图层）" class="headerlink" title="WXML语法（视图层）"></a>WXML语法（视图层）</h3><ul>
<li><strong>数据绑定</strong><br>数据绑定使用 Mustache 语法。WXML中的动态数据全部来自于对应 Page 方法中定义的 data。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// xxx.js</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">Page(&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">  data: &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    id: <span class="string">'my_mini_program'</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    condition: <span class="string">''</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    message: <span class="string">'Hello MINA!'</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">  &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">&#125;)</span></pre></td></tr></table></figure>

</li>
</ul>
<p>除了内容渲染外、组件属性、控制属性、关键字都需要使用双引号。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// 组件属性</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">&lt;view id=<span class="string">"item-&#123;&#123;id&#125;&#125;"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// 控制属性</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">&lt;view wx:<span class="keyword">if</span>=<span class="string">"&#123;&#123;condition&#125;&#125;"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// 关键字</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">&lt;checkbox checked=<span class="string">"&#123;&#123;false&#125;&#125;"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">checkbox</span>&gt;</span></span></span></pre></td></tr></table></figure>

<ul>
<li><p><strong>列表渲染</strong></p>
<p><strong>wx:for</strong></p>
<p>在组件上使用 wx:for 控制属性绑定一个数组，就可以直接使用数组中各项的数据重复渲染该组件。默认数组的当前想的下标变量名默认为 index，数组当前项的变量名默认为 item。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&lt;view wx:<span class="keyword">for</span>=<span class="string">"&#123;&#123;array&#125;&#125;"</span> wx:<span class="keyword">for</span>-index=<span class="string">"idx"</span> ewx:<span class="keyword">for</span>-item=<span class="string">"itemName"</span>&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// &#123;&#123;index&#125;&#125;: &#123;&#123;item.message&#125;&#125;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">&#123;&#123;idx&#125;&#125;: &#123;&#123;itemName.message&#125;&#125;&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">&lt;<span class="regexp">/view&gt;</span></span></pre></td></tr></table></figure>

<p><strong>block wx:for</strong><br>类似 block wx:if，也可以将 wx:for 用在<block/>标签上，以渲染一个包含多节点的结构块。例如：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&lt;block wx:<span class="keyword">for</span>=<span class="string">"&#123;&#123;[1, 2, 3]&#125;&#125;"</span>&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">  &lt;view&gt;&#123;&#123;index&#125;&#125;:<span class="xml"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">  &lt;view&gt;&#123;&#123;item&#125;&#125;&lt;<span class="regexp">/view&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">&lt;/</span>block&gt;</span></pre></td></tr></table></figure>

<p><strong>wx:key</strong><br>同React 中 key 值的概念，小程序中需要使用 wx:key 来指定动态变化的列表渲染数据中item的唯一标识符。</p>
<p>wx:key 的值以两种形式提供</p>
<ol>
<li><p>字符串，代表在 for 循环的 array 中 item 的某个 property，该 property 的值需要是列表中唯一的字符串或数字，且不能动态改变。</p>
</li>
<li><p>保留关键字 *this 代表在 for 循环中的 item 本身，这种表示需要 item 本身是一个唯一的字符串或者数字</p>
</li>
</ol>
<blockquote>
<p>注：如不提供 wx:key，会报一个 warning， 如果明确知道该列表是静态，或者不必关注其顺序，可以选择忽略。</p>
</blockquote>
</li>
<li><p><strong>条件渲染</strong></p>
<p><strong>wx:if</strong><br>小程序框架中，可以使用 wx:if=”“ 来判断是否渲染该代码块。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&lt;view wx:<span class="keyword">if</span>=<span class="string">"&#123;&#123;condition&#125;&#125;"</span>&gt;Contents&lt;<span class="regexp">/view&gt;</span></span></pre></td></tr></table></figure>

<p>也可以使用 wx:elif 和 wx:else 来添加一个 else 块。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&lt;view wx:<span class="keyword">if</span>=<span class="string">"&#123;&#123;length &gt; 5&#125;&#125;"</span>&gt;<span class="number">1</span>&lt;<span class="regexp">/view&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">&lt;view wx:elif="&#123;&#123;length &gt; 2&#125;&#125;"&gt;2&lt;/</span>view&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">&lt;view wx:<span class="keyword">else</span>&gt;<span class="number">3</span>&lt;<span class="regexp">/view&gt;</span></span></pre></td></tr></table></figure>

<p><strong>block wx:if</strong></p>
<p>当控制属性 wx:if 一次性需要判断多个组件标签时，可以使用 <block /> 标签将多个组件报过起来，并在其上使用控制属性 wx:if。但  <block /> 并不是一个组件，只作为一个包裹元素，类似于 React 中的 Fragment。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&lt;block wx:<span class="keyword">if</span>=<span class="string">"&#123;&#123;true&#125;&#125;"</span>&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">  &lt;view&gt;&#123;&#123; view &#125;&#125;&lt;<span class="regexp">/view&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">  &lt;view&gt;view2&lt;/</span>view&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">&lt;<span class="regexp">/block&gt;</span></span></pre></td></tr></table></figure>
</li>
<li><p><strong>模板</strong></p>
<p>WXML提供了模板（template）的概念，开发者可以在模板中定义代码片段，在其他不同模块中调用。</p>
<p>定义一个模板。使用 name 属性作为模板的名称，然后在这个模板内定义代码片段：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&lt;template name=<span class="string">"msgItem"</span>&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">  &lt;view&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    &lt;text&gt;...&lt;<span class="regexp">/text&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">  &lt;/</span>view&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">&lt;<span class="regexp">/template&gt;</span></span></pre></td></tr></table></figure>

<p>使用模板。使用 is 属性，声明需要使用的模板，然后将模板所需数据传入到属性中即可。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&lt;template is=<span class="string">"msgItem"</span> data=<span class="string">"&#123;&#123;...item&#125;&#125;"</span> /&gt;</span></pre></td></tr></table></figure>

<p>开发者也可以使用 is 属性的 Mustache 语法，动态决定具体需要渲染哪些模板内容（即在 is 中做逻辑判断）。同时，模板中只能使用 data 传进来的数据。</p>
<p>很多时候，模板用来抽取小程序页面页头和页脚的通用组件。</p>
<br></li>
<li><p><strong>引用</strong><br>WXML提供了两种文件引用方式 import 和 include。</p>
<p><strong>import</strong></p>
<p>那么上面定义了模板文件，该如何将文件引入到目标组件中呢？可以使用 import 方式。</p>
<p>比如上述模板 msgItem 是在 item.wxml 中定义的，那么我们如果想要在 index.wxml 文件中引入，只需要这样做：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.wxml</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">import</span> src=<span class="string">"item.wxml"</span>&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">&lt;template is=<span class="string">"msgItem"</span> data=<span class="string">"&#123;&#123;...item&#125;&#125;"</span> /&gt;</span></pre></td></tr></table></figure>

<p><strong>include</strong></p>
<p>可以简单的将 include 的作用理解成拷贝一份文件到当前位置，但所拷贝的目标文件中的 <code>&lt;template /&gt;</code> 和 <code>&lt;wxs /&gt;</code> 不会被引入。</p>
<p>例如：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// header.wxml</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">&lt;view&gt;header infos&lt;<span class="regexp">/view&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="regexp"></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">/</span><span class="regexp">/ footer.wxml</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">&lt;view&gt;footer infos&lt;/</span>view&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.wxml</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">&lt;include src=<span class="string">"header.wxml"</span> /&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">&lt;view&gt;body infos&lt;<span class="regexp">/view&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">&lt;include src="footer.wxml" /</span>&gt;</span></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="API与云开发"><a href="#API与云开发" class="headerlink" title="API与云开发"></a>API与云开发</h2><h3 id="小程序API与服务端API"><a href="#小程序API与服务端API" class="headerlink" title="小程序API与服务端API"></a>小程序API与服务端API</h3><p>小程序开发框架提供了丰富的微信原生API，可以方便地调用微信提供的能力。如获取用户信息、本地存储、扫码支付等。</p>
<p>小程序API有以下类型：</p>
<ol>
<li>事件监听API</li>
<li>同步API</li>
<li>异步API</li>
</ol>
<p>参阅 API 与 服务端API，查看小程序的开放接口的具体使用方法。</p>
<h2 id="云开发"><a href="#云开发" class="headerlink" title="云开发"></a>云开发</h2><ol>
<li><p>通过开发者工具创建具有云开发功能的QuickStart项目，点击工具栏云开发按钮开通云开发功能。<br>图片: <a href="https://uploader.shimo.im/f/VGpLQS9JHIgj66aI.png" target="_blank" rel="noopener">https://uploader.shimo.im/f/VGpLQS9JHIgj66aI.png</a></p>
</li>
<li><p>创建云开发环境。<br>图片: <a href="https://uploader.shimo.im/f/7zJ3dkdep2kfPMJc.png" target="_blank" rel="noopener">https://uploader.shimo.im/f/7zJ3dkdep2kfPMJc.png</a><br>图片: <a href="https://uploader.shimo.im/f/F8pZyDpM1Wkr1kLg.png" target="_blank" rel="noopener">https://uploader.shimo.im/f/F8pZyDpM1Wkr1kLg.png</a></p>
</li>
<li><p>在云开发控制台中使用数据库、存储、云函数功能，查看小程序云端开发运营分析数据。<br>图片: <a href="https://uploader.shimo.im/f/gpveYbiJAego1Ut8.png" target="_blank" rel="noopener">https://uploader.shimo.im/f/gpveYbiJAego1Ut8.png</a></p>
</li>
</ol>
<h2 id="小程序示例源码分析"><a href="#小程序示例源码分析" class="headerlink" title="小程序示例源码分析"></a>小程序示例源码分析</h2><p>参见源码。</p>
<h2 id="参考站点"><a href="#参考站点" class="headerlink" title="参考站点"></a>参考站点</h2><ol>
<li><a href="https://developers.weixin.qq.com/miniprogram/introduction/index.html" target="_blank" rel="noopener">微信公众平台 - 小程序开发</a></li>
<li><a href="http://www.wxapp-union.com/portal.php" target="_blank" rel="noopener">小程序社区</a></li>
<li><a href="https://v.qq.com/x/cover/b86kk0n60chvn5j/b0029zsv8t9.html" target="_blank" rel="noopener">2019年微信公开课PRO</a></li>
<li><a href="https://developers.weixin.qq.com/community/develop/article/doc/000e4a51524570e51278579d656c13" target="_blank" rel="noopener">微信开放社区 - Taro团队携手云开发搭建电商后台服务</a></li>
<li><a href="https://www.zhihu.com/question/50907897/answer/785422713" target="_blank" rel="noopener">知乎：如何入门微信小程序开发，有哪些学习资料？</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://henery002.github.io/2019/03/20/%E4%BD%BF%E7%94%A8components%E5%B1%9E%E6%80%A7%E5%AF%B9Table%E4%BA%8C%E6%AC%A1%E5%B0%81%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="魏范光">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/IMG_20190808_014018.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Henery 的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/20/%E4%BD%BF%E7%94%A8components%E5%B1%9E%E6%80%A7%E5%AF%B9Table%E4%BA%8C%E6%AC%A1%E5%B0%81%E8%A3%85/" itemprop="url">使用components属性对Table二次封装</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-20T10:00:00+08:00">
                2019-03-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><p>需求：</p>
<blockquote>
<p>DanaStudio v4.2中数据治理 - 标准化：实现两个表格间行数据的拖拽联动效果</p>
</blockquote>
<p>效果图：<br>图片: <a href="https://uploader.shimo.im/f/MY3pr7nzbC02KSHr.gif" target="_blank" rel="noopener">https://uploader.shimo.im/f/MY3pr7nzbC02KSHr.gif</a></p>
<h2 id="由Table拖拽排序带来的思考"><a href="#由Table拖拽排序带来的思考" class="headerlink" title="由Table拖拽排序带来的思考"></a>由Table拖拽排序带来的思考</h2><h3 id="一些尝试"><a href="#一些尝试" class="headerlink" title="一些尝试"></a>一些尝试</h3><p>最初曾尝试通过对Table组件的 columns 属性进行包裹，以期达到封装 DragSource 和 DropTarget 的效果，但后来发现，antd根本不会识别这样的修改。</p>
<p>那么antd到底是否开放了一些自定义事件供开发者使用呢？</p>
<h3 id="官方案例"><a href="#官方案例" class="headerlink" title="官方案例"></a>官方案例</h3><p>antd官方文档提供了Table单一表格的行拖拽排序，并没有暴露出更多可详细配置的API。</p>
<p>在拖拽排序的案例中，BodyRow既是DragSource，也是DopTarget。那么既然如此，理应也允许针对BodyRow进行二次封装，达到DragSource与DropTarget的独立，从而实现跨表格的行（row）或列（column）的拖拽。</p>
<p>在开始本文的探讨之前，先来回顾一下react dnd的基础知识。</p>
<h2 id="React-DnD回顾"><a href="#React-DnD回顾" class="headerlink" title="React DnD回顾"></a>React DnD回顾</h2><h3 id="什么是react-dnd"><a href="#什么是react-dnd" class="headerlink" title="什么是react dnd"></a>什么是react dnd</h3><p>React DnD是一组React高阶组件，它可以帮开发者构建复杂的拖放接口，同时保持组件解耦。借助react dnd的拖动事件在组件之间传输数据，组件根据拖放事件改变它们的外观和状态（数据）。</p>
<h3 id="核心API"><a href="#核心API" class="headerlink" title="核心API"></a>核心API</h3><p>react-dnd使用的核心API有以下几个：</p>
<ol>
<li><strong>DragSource</strong>：用于包装你需要拖动的组件，使组件能够被拖拽。</li>
<li><strong>DropTarget</strong>：用于包装接收拖拽元素的组件，使组件能够放置。</li>
<li><strong>DragDropContext</strong>：用于包装拖拽根组件，DragSource 和 DropTarget 都需要包裹在DragDropContext内。</li>
<li><strong>DragDropContextProvider</strong>：与 DragDropContex 类似，用DragDropContextProvider元素包裹拖拽根组件。</li>
</ol>
<h3 id="API参数"><a href="#API参数" class="headerlink" title="API参数"></a>API参数</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">@DragSource(type, spec, collect)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">@DropTarget(types, spec, collect)</span></pre></td></tr></table></figure>

<p>DragSource、DropTarget分别有三个参数：</p>
<ul>
<li>type: 拖拽类型，必填。</li>
<li>spec：拖拽事件的方法对象，必填。</li>
<li>collect：拖拽过程中需要注入组件的props信息，接收两个参数 connect 和 monitor，必填。</li>
</ul>
<p>其中：</p>
<ol>
<li><strong>type</strong></li>
</ol>
<p>当source组件的type和target组件的type一致时，target组件可以接受source组件。其值类型可以使string， symbol，也可以是一个函数来返回该组件的其他props。</p>
<ol start="2">
<li><strong>spec</strong></li>
</ol>
<p>spec是用来<strong>定义特定方法的一个对象</strong>，如source组件的spec可以定义拖动相关的事件，target组件的spec可以定义放置相关的事件。具体如下：</p>
<p><strong>DragSource speObj</strong>：</p>
<ul>
<li><strong>beginDrag</strong>(props, monitor, component)</li>
</ul>
<p>拖动开始时触发的事件，required。返回与props相关的对象。</p>
<ul>
<li><strong>endDrag</strong>(props, monitor, component)</li>
</ul>
<p>拖动结束时触发的事件，optional。</p>
<ul>
<li><strong>canDrag</strong>(props, monitor)</li>
</ul>
<p>当前是否可以拖拽的事件，optional。</p>
<ul>
<li><strong>isDrag</strong>(props, monitor)</li>
</ul>
<p>拖拽时触发的事件，optional。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// DragSource源组件的 spec 属性</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> dragSpec = &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">  beginDrag(props) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="built_in">console</span>.log(<span class="string">'%c beginDrag...'</span>, <span class="string">'color: #F8B400'</span>, props);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">  &#125;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">  endDrag(props, monitor) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">const</span> item = monitor.getItem();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">const</span> dropResult = monitor.getDropResult();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    <span class="built_in">console</span>.log(item, dropResult, <span class="string">'endDrag...'</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">  &#125;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">&#125;;</span></pre></td></tr></table></figure>

<p><strong>DropTarget specObj</strong>：</p>
<ul>
<li><strong>drop</strong>(props, monitor, component)</li>
</ul>
<p>组件被放下时触发的事件，optional。</p>
<ul>
<li><strong>hover</strong>(props, monitor, component)</li>
</ul>
<p>组件在DropTarget上方时响应的事件，optional。</p>
<ul>
<li><strong>canDrop</strong>(props, monitor)</li>
</ul>
<p>组件可以被放置时触发的事件，可选。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// DropTarget目标组件</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> targetSpec = &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">  drop(props, monitor) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">// dropTarget 行的值</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">const</span> &#123; record &#125; = props.children[<span class="number">0</span>].props;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">// dragSource 行的值</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">const</span> dragItem = monitor.getItem();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">  &#125;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">&#125;;</span></pre></td></tr></table></figure>

<p>其中，specObj这个对象方法中的相关参数为：</p>
<ul>
<li>props：组件当前的props。</li>
<li>monitor：查询当前的拖拽状态，*<u>比如当前拖拽的item和他的type，当前拖拽的offsets，当前是否dropped</u>*。</li>
<li>component：当前组件的实例。</li>
</ul>
<ol start="3">
<li><strong>collect</strong></li>
</ol>
<p>collect是一个函数，默认有两个参数：<strong>connect</strong> 和 <strong>monitor</strong>。该函数将返回一个对象，这个对象会<strong>被注入到props中</strong>，也就是说，我们<strong>可以在目标组件中通过 this.props 获取到通过collect注入进来的所有属性</strong>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// TODO 封装 DropTarget 组件</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> DropBodyRow = DropTarget(Types.CARD, targetSpec, (connect, monitor) =&gt; &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">  <span class="keyword">return</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">// 由 collect 函数返回的对象中的API，可以在组件中利用 this.props 获取</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    connectDropTarget: connect.dropTarget(),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    isOver: monitor.isOver(),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    canDrop: monitor.canDrop(),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">  &#125;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">&#125;)(BodyRow);</span></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在组件中通过使用 this.props 获取API</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BodyRow</span> <span class="keyword">extends</span> <span class="title">PureComponent</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">  render() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">const</span> &#123; connectDropTarget, isOver, canDrop &#125; = <span class="keyword">this</span>.props;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">return</span> connectDropTarget(</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">      &lt;tr &#123;...restProps&#125; /&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    );</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">  &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>在 collect 函数的两个参数中：</p>
<ul>
<li><p><strong>connect</strong><br>source组件  的 collect 中的 connect 是DragSourceConnector 的实例，它内置了两个方法：<strong>dragSource()</strong> 和 <strong>dragPreview()</strong> 。<strong>dragSource() 返回一个方法，将source组件传入这个方法，可以将 source DOM 和 React DnD backend 连接起来</strong>；dragPreview() 返回一个方法，可以将其传入节点，作为拖拽预览时的角色。</p>
<p>target组件 的 collect 中 connect 是 DropTargetConnector 的实例。<strong>内置的方法 dropTarget() 对应 DragSource()，返回可以将 drop target 和 React DnD backend 连接起来的方法</strong>。</p>
</li>
<li><p><strong>monitor</strong><br>monitor用来<strong>查询当前的拖拽状态</strong>，其对应实例内置了很多方法。由于使用场景不是很必要，这里就不再一一赘述。详情可以移步官网研究。</p>
</li>
</ul>
<p>在熟悉了React DnD的相关内容后，来看看如何针对Table的BodyRow进行二次封装。</p>
<h2 id="对Table-Row二次封装"><a href="#对Table-Row二次封装" class="headerlink" title="对Table Row二次封装"></a>对Table Row二次封装</h2><p>antd3.0 新增了 components 属性，用于覆盖默认的table元素。官方更新日志上也只是提供了简单的配置说明，没有详细的案例。</p>
<h3 id="antd源码解读"><a href="#antd源码解读" class="headerlink" title="antd源码解读"></a>antd源码解读</h3><p>因为官方文档并没有针对这个属性做过多解释，所以就找到了它的源码来看一哈。<br>在antd table的源码中发现，Table组件在初始化时会调用 createComponents 方法。</p>
<p>图片: <a href="https://uploader.shimo.im/f/U409TsQht4YQn9Vr.png" target="_blank" rel="noopener">https://uploader.shimo.im/f/U409TsQht4YQn9Vr.png</a><br>图二</p>
<p>这个方法最终<strong>在 this.components 上设置了一个 components 对象</strong>。</p>
<p>图片: <a href="https://uploader.shimo.im/f/EuiJRAWDakMycp3z.png" target="_blank" rel="noopener">https://uploader.shimo.im/f/EuiJRAWDakMycp3z.png</a><br>图三</p>
<p>this.components 最终<strong>在 render() 方法中被调用</strong>。</p>
<p>图片: <a href="https://uploader.shimo.im/f/RtoEralutDARNcAA.png" target="_blank" rel="noopener">https://uploader.shimo.im/f/RtoEralutDARNcAA.png</a><br>图四</p>
<p>定位到 components 属性，不难发现，最终用来覆盖修改 row 或者 column 的，就是它。</p>
<p>图片: <a href="https://uploader.shimo.im/f/N3cXkCYTHP4oq3zP.png" target="_blank" rel="noopener">https://uploader.shimo.im/f/N3cXkCYTHP4oq3zP.png</a><br>图五</p>
<p>TableComponent 属性重新定义了表格的 header、body，其中，在我们的场景中所需要的就是 row 属性，将自己用 DropTarget 二次封装好的 BodyRow 组件挂到components中。components属性最终将会在render()方法中被调用，实现预期效果。</p>
<p>图片: <a href="https://uploader.shimo.im/f/5jZ6PljW5iULIU7A.png" target="_blank" rel="noopener">https://uploader.shimo.im/f/5jZ6PljW5iULIU7A.png</a><br>图六</p>
<h2 id="拓展案例"><a href="#拓展案例" class="headerlink" title="拓展案例"></a>拓展案例</h2><ol>
<li><a href="https://codepen.io/raisezhang/pen/MmjypX" target="_blank" rel="noopener">Table行拖拽排序</a></li>
<li><a href="https://codepen.io/raisezhang/pen/MoMoyz" target="_blank" rel="noopener">Table列拖拽排序</a></li>
<li><a href="https://github.com/ant-design/ant-design/issues/4639" target="_blank" rel="noopener">Table 能否提供拖拽事件或者开放自定义事件</a></li>
</ol>
<h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><ol>
<li><a href="http://react-dnd.github.io/react-dnd/docs/overview" target="_blank" rel="noopener">React DnD官方文档</a></li>
<li><a href="https://segmentfault.com/a/1190000014723549" target="_blank" rel="noopener">React DnD的使用</a></li>
<li><a href="https://segmentfault.com/q/1010000012347287" target="_blank" rel="noopener">antd3.0中新增的 components 属性的使用</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://henery002.github.io/2019/01/11/React%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-Render-Props/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="魏范光">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/IMG_20190808_014018.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Henery 的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/11/React%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-Render-Props/" itemprop="url">React设计模式-Render Props</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-11T11:42:14+08:00">
                2019-01-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2><p>React官方文档对render props做出的介绍是这样的：</p>
<blockquote>
<p>The term “render prop” refers to a technique for sharing code between React components using a prop whose value is a function.</p>
</blockquote>
<p>本文将针对Render Props的使用方法，对比高阶组件，简单了解为什么需要使用以及如何正确使用这两种设计模式。</p>
<h2 id="什么是Render-Props"><a href="#什么是Render-Props" class="headerlink" title="什么是Render Props"></a>什么是Render Props</h2><p><strong>render props</strong> 是一种<strong>在不重复代码的情况下实现组件共享</strong>的方法。同为React的设计模式，render props与<strong>高阶组件（HOC，Higher-Order Components）</strong>的思想一样，都是为了组件复用以达到<strong>DRY模式</strong>。</p>
<p>一个栗子：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&lt;DataProvider render=&#123;data =&gt; (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">  &lt;h1&gt;Hello &#123;data.target&#125;&lt;<span class="regexp">/h1&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">)&#125;&gt;</span></span></pre></td></tr></table></figure>

<p>通过使用props来定义呈现的内容，组件只起到注入功能，而不需要知道它如何应用于UI层。render props模式意味着用于通过定义单独的组件来传递props方法，来指示共享组件应该返回的内容。</p>
<p>Render Props的<strong>核心思想</strong>是：通过一个函数将class组件的state作为props传递给纯函数组件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> SharedComponent  extends React.Component &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">  state = &#123;...&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">  render() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">return</span> (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">      &lt;div&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">        &#123;<span class="keyword">this</span>.props.render(<span class="keyword">this</span>.state)&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">      &lt;<span class="regexp">/div&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">    )</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">  &#125;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">&#125;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="regexp"></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">export default SharedComponent;</span></span></pre></td></tr></table></figure>

<p>this.props.render是由另一个组件传递过来的。为了使用 SharedComponent 组件，可以进行这样的操作：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SharedComponent <span class="keyword">from</span> <span class="string">'./SharedComponent'</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> SayHello = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">  &lt;SharedComponent render=&#123;(state) =&gt; (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    &lt;span&gt;Hello, &#123;...state&#125;&lt;<span class="regexp">/span&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">  )&#125; /</span>&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">&#125;;</span></pre></td></tr></table></figure>

<p>其中，{this.props.render(this.state)} 这个函数，将其state作为参数传入props.render方法中，调用时直接取组件所需的state即可。</p>
<p><strong>值得注意的是：</strong></p>
<blockquote>
<p>渲染属性这种设计模式虽然叫作 render props，但是并不一定就要使用 render 这个名字来传递目标渲染函数，开发者可以修改成任意其他名称。</p>
</blockquote>
<h2 id="为什么需要Render-Props"><a href="#为什么需要Render-Props" class="headerlink" title="为什么需要Render Props"></a>为什么需要Render Props</h2><p>搜罗到一个通俗易懂的案例：</p>
<ul>
<li><strong>场景一：</strong><br>假设我们正在开发一个电子商务应用程序。它与其他电子商务应用程序一样，向用户显示所有可购买产品，并且用户可以将任何产品添加到购物车。我们将从 API 获取产品数据，并将产品目录显示为卡片列表。</li>
</ul>
<p>我们一般会写一个这样的 ProductList 组件来处理这个需求：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProductList</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">  state = &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    products: []</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">  &#125;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">  componentDidMount() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    getProducts().then(<span class="function"><span class="params">products</span> =&gt;</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">      <span class="keyword">this</span>.setState(&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">        products</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">      &#125;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">    &#125;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">  &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">  render() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">return</span> (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">      &lt;ul&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">        &#123;<span class="keyword">this</span>.state.products.map(<span class="function"><span class="params">product</span> =&gt;</span> (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">          &lt;li&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">            &lt;span&gt;&#123;product.name&#125;&lt;<span class="regexp">/span&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">            &lt;a href="#"&gt;Add to Cart&lt;/</span>a&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">          &lt;<span class="regexp">/li&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">        ))&#125;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">      &lt;/u</span>l&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">    );</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line">  &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> &#123; ProductList &#125;;</span></pre></td></tr></table></figure>

<ul>
<li><strong>场景二：</strong><br>在上一个场景中，对于管理员来说，有一个管理门户，他们可以在其中添加或删除产品。在此门户中，要从同一 API 获取产品数据，并以<strong>表格形式</strong>显示产品目录。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProductTable</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">  state = &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    products: []</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">  &#125;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">  componentDidMount() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    getProducts().then(<span class="function"><span class="params">products</span> =&gt;</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">      <span class="keyword">this</span>.setState(&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">        products</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">      &#125;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">    &#125;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">  &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">  handleDelete = <span class="function"><span class="params">currentProduct</span> =&gt;</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">const</span> remainingProducts = <span class="keyword">this</span>.state.products.filter(</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">      product =&gt; product.id !== currentProduct.id</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">    );</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">    deleteProducts(currentProduct.id).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">      <span class="keyword">this</span>.setState(&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">        products: remainingProducts</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">      &#125;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">    &#125;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">  &#125;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line">  render() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">return</span> (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line">      &lt;table&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line">        &lt;thead&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line">          &lt;tr&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line">            &lt;th&gt;Product Name&lt;<span class="regexp">/th&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">            &lt;th&gt;Actions&lt;/</span>th&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">34</span></pre></td><td class="code"><pre><span class="line">          &lt;<span class="regexp">/tr&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">35</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">        &lt;/</span>thead&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">36</span></pre></td><td class="code"><pre><span class="line">        &lt;tbody&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">37</span></pre></td><td class="code"><pre><span class="line">          &#123;<span class="keyword">this</span>.state.products.map(<span class="function"><span class="params">product</span> =&gt;</span> (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">38</span></pre></td><td class="code"><pre><span class="line">            &lt;tr key=&#123;product.id&#125;&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">39</span></pre></td><td class="code"><pre><span class="line">              &lt;td&gt;&#123;product.name&#125;&lt;<span class="regexp">/td&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">40</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">              &lt;td&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">41</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">                &lt;button onClick=&#123;() =&gt; this.handleDelete(product)&#125;&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">42</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">                  Delete</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">43</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">                &lt;/</span>button&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">44</span></pre></td><td class="code"><pre><span class="line">              &lt;<span class="regexp">/td&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">45</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">            &lt;/</span>tr&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">46</span></pre></td><td class="code"><pre><span class="line">          ))&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">47</span></pre></td><td class="code"><pre><span class="line">        &lt;<span class="regexp">/tbody&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">48</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">      &lt;/</span>table&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">49</span></pre></td><td class="code"><pre><span class="line">    );</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">50</span></pre></td><td class="code"><pre><span class="line">  &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">51</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">52</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">53</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> &#123; ProductTable &#125;;</span></pre></td></tr></table></figure>

</li>
</ul>
<p>现在我们来分析一下：</p>
<p>上面两个场景都实现了产品数据的获取。但是当出现下述情况时，上面写的两个组件将暴露出弊端：</p>
<ol>
<li>在不同场景下必须用不同的方式展示数据时；</li>
<li>当改为从localStorage中访问数据而不是从API获取时；</li>
<li>在产品目录表格中，需要使用具有不同操作的按钮而不都是删除按钮时</li>
<li>……</li>
</ol>
<p>如果每个场景下都手动写一个这个样的组件，那么将有大量冗余的代码。<br>从上面来看，<strong>获取数据</strong>和<strong>显示数据</strong>是两个独立的点，那么我们是不是可以据此分离出独立组件来处理这样的逻辑？</p>
<p>重构第一个组件 <strong>ProductList</strong>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ProductList = <span class="function">(<span class="params">&#123; products &#125;</span>) =&gt;</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">  <span class="keyword">return</span> (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    &lt;ul&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">      &#123;products.map(<span class="function"><span class="params">product</span> =&gt;</span> (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">        &lt;li key=&#123;product.id&#125;&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">          &lt;span&gt;&#123;product.name&#125;&lt;<span class="regexp">/span&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">          &lt;a href="#"&gt;Add to Cart&lt;/</span>a&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">        &lt;<span class="regexp">/li&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">      ))&#125;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">    &lt;/u</span>l&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">  );</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">&#125;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> &#123; ProductList &#125;;</span></pre></td></tr></table></figure>

<p>同理，第二个组件 ProductTable 接收产品数据作为属性，并把数据渲染到表格中。</p>
<p>现在来创建一个 ProductData 组件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProductData</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">  state = &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    products: []</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">  &#125;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">  componentDidMount() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    getProducts().then(<span class="function"><span class="params">products</span> =&gt;</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">      <span class="keyword">this</span>.setState(&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">        products</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">      &#125;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">    &#125;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">  &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">  render() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">return</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">      <span class="comment">// 此处应该处理怎样的逻辑？</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">    &#125;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">  &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> &#123; ProductData &#125;;</span></pre></td></tr></table></figure>

<p>这个组件仍然是从API获取数据，逻辑同 <em>ProductList</em> 组件一样。但是在 render 方法中，却不再是调用 <em>ProductList</em> 组件。如果这个组件可以询问开发者需要渲染什么内容，那么问题就会到有效解决。比如在场景一中，我们告诉它要渲染 <em>ProductList</em> 组件，在场景二中让它渲染 <em>ProductTable</em> 组件。</p>
<p>对于一个组件，会询问它该在什么场景下渲染什么内容，这就是render props发挥作用的地方。这种设计思想进一步推动了代码的复用。</p>
<h2 id="如何使用Render-Props"><a href="#如何使用Render-Props" class="headerlink" title="如何使用Render Props"></a>如何使用Render Props</h2><p>从概念层面不难理解render props的原理，现在来看看以上面的需求为例，该如何应用渲染属性。</p>
<p>首先我们要<strong>封装一个组件 <em>ProductData</em></strong> （还是上面的案例），通过<strong>属性</strong>传递给该组件一个函数，用来获取产品数据（公共方法），并将这些数据<strong>提供给以属性方式传递进来的函数</strong>。这个传递进来的函数就可以对产品数据做任何场景需求上的操作了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// ProductData组件</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProductData</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">  state = &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    products: []</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">  &#125;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">  componentDidMount() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    getProducts().then(<span class="function"><span class="params">products</span> =&gt;</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">      <span class="keyword">this</span>.setState(&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">        products</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">      &#125;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">    &#125;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">  &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">  render() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.props.render(&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">      products: <span class="keyword">this</span>.state.products</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">    &#125;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">  &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> &#123; ProductData &#125;;</span></pre></td></tr></table></figure>

<p>就像前面说的，有了这个组件，我们就需要在不同场景下使用它：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// 场景一</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">&lt;ProductData</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">  render=&#123;(&#123; products &#125;) =&gt; <span class="xml"><span class="tag">&lt;<span class="name">ProductList</span> <span class="attr">products</span>=<span class="string">&#123;products&#125;</span> /&gt;</span>&#125;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="xml">/&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="xml">// 场景二</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">&lt;ProductData</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">  render=&#123;(&#123; products &#125;) =&gt; &lt;ProductTable products=&#123;products&#125; /&gt;&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">/&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">// 场景三</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">&lt;ProductData render=&#123;(&#123; products &#125;) =&gt; (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">  &lt;h1&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">      Number of Products:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">      &lt;strong&gt;&#123;products.length&#125;&lt;/strong&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">  &lt;/h1&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">)&#125; /&gt;</span></pre></td></tr></table></figure>

<p>这就是render props用来构建高度可复用组件的设计思想，它已经成为了一种通用的设计模式。正如之前分享的一篇文章《React组件解耦》中说的，<strong>渲染属性</strong>和<strong>高阶函数</strong>可以起到同样的作用，甚至可以<strong>相互转化</strong>。</p>
<h2 id="HOC设计模式"><a href="#HOC设计模式" class="headerlink" title="HOC设计模式"></a>HOC设计模式</h2><p>限于篇幅的原因，这里简要引入一下高阶组件的设计思想。</p>
<p>高阶组件本质是一个函数，接收一个组件作为其参数，然后返回一个组件，同时为该组件添加一些额外的功能（有点类似于ES6中的装饰器函数）。</p>
<p>封装一个高阶函数组件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数式组件，接收一个组件作为参数，并返回一个新组件</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">withProductData</span>(<span class="params">WrappedComponent, selectData</span>)</span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">  <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    state = &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">      products: []</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    &#125;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    componentDidMount() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">      getProducts().then(<span class="function"><span class="params">products</span> =&gt;</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">this</span>.setState(&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">          products</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">        &#125;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">      &#125;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">    render() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">      <span class="keyword">return</span> (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">        &lt;WrappedComponent</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">          <span class="comment">// 使用最新的数据渲染组件</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">          products=&#123;<span class="keyword">this</span>.state.products&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">          <span class="comment">// 将已有的props属性传递给原组件</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">          &#123;...this.props&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">        /&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">      );</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">  &#125;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>在高阶组件中数据的获取和状态更新的原理与render props一样。只是高阶组件中组件类位于函数内部。这个函数接收一个组件作为参数，然后在内部的render方法中渲染这个组件，并且添加额外的属性。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在不同场景下调用高阶组件</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ProductListWithData = withProductData(ProductList);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ProductTableWithData = withProductData(ProductTable);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">render() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">  <span class="keyword">return</span> (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    &lt;div&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">      &lt;ProductListWithData /&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">      &lt;ProductTableWithData /&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">    &lt;<span class="regexp">/div</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">  )</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">&#125;</span></span></pre></td></tr></table></figure>

<h2 id="Render-Props-Vs-HOC"><a href="#Render-Props-Vs-HOC" class="headerlink" title="Render Props Vs HOC"></a>Render Props Vs HOC</h2><p>高阶组件优劣并存：</p>
<ul>
<li>支持ES6；</li>
<li>复用性强，HOC是纯函数且返回值还是组件，在使用时<strong>可以多层嵌套</strong>，在不同情境下使用特定的HOC组合也便于调试；</li>
<li>由于是纯函数，<strong>支持传入多个参数</strong>，增强了其适用范围。</li>
</ul>
<br>

<ul>
<li>当有多个HOC一同使用时，无法直接判断子组件的props是哪个HOC负责传递的；</li>
<li><strong>重复命名</strong>的问题：若父子组件有同样名称的props，或使用的多个HOC中存在相同名称的props，则存在覆盖问题，而且react也不会报错；</li>
<li>HOC的嵌套产生了很多无用的组件，加深了组件层级；</li>
<li>使用<strong>静态构建</strong>。在上例中，当 ProductListWithData 被创建时，调用了一次 withProductData 中的静态构建。而在 render 中调用构建方法才是react所倡导的动态构建思想。此外，在 render 中构建还可以更好地利用react的生命周期。 </li>
</ul>
<p>render props相较而言，有这些优势：</p>
<ul>
<li>同样支持ES6；</li>
<li>不用担心props的命名问题，在render函数中<strong>只取所需要的state</strong>即可；</li>
<li>不会产生过多的无用空组件加深层级；</li>
<li>使用<strong>动态构建</strong>。即所有的改变都在 render 中触发，可以更好地利用react的生命周期。</li>
</ul>
<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>同样作为React的设计模式，个人认为还没有达到谁必须要取代谁的地步。有很多第三方开源库也都使用了这两种设计模式来设计API的实现。在实际开发项目中，根据业务需要，选择一种适合自己的方式即可。</p>
<p>附：<a href="https://github.com/jaredpalmer/awesome-react-render-props" target="_blank" rel="noopener">使用render props的开源库</a></p>
<h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><ol>
<li>segmentfault - <a href="https://segmentfault.com/a/1190000013102142" target="_blank" rel="noopener">《render props从介绍到实践》</a>- Anx</li>
<li>React官方文档 - <a href="https://reactjs.org/docs/render-props.html" target="_blank" rel="noopener">《Render Props》</a></li>
<li><strong><a href="https://www.richardkotze.com/coding/understanding-render-props-react-js" target="_blank" rel="noopener">《Understanding React JS Render Props》</a>- Richard Kotze</strong></li>
<li><a href="https://www.richardkotze.com/coding/hoc-vs-render-props-react" target="_blank" rel="noopener">《Higher-order components Vs Render Props》</a>- Richard Kotze</li>
<li>掘金 - <a href="https://juejin.im/post/5ad7ee045188252e93239dd7" target="_blank" rel="noopener">《高阶组件的那些事》</a>- Srtian</li>
<li>简书 - <a href="https://www.jianshu.com/p/ff6b3008820a?utm_campaign=maleskine&utm_content=note&utm_medium=seo_notes&utm_source=recommendation" target="_blank" rel="noopener">《React组件Render Props VS HOC设计模式》</a>- Perkin</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://henery002.github.io/2019/01/01/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="魏范光">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/IMG_20190808_014018.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Henery 的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/01/hello-world/" itemprop="url">Hello World</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-01T10:00:00+08:00">
                2019-01-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">$ hexo server</span></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">$ hexo generate</span></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://henery002.github.io/2018/11/29/React-Hooks/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="魏范光">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/IMG_20190808_014018.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Henery 的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/29/React-Hooks/" itemprop="url">React Hooks</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-29T13:39:57+08:00">
                2018-11-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2><p>在开始本文的探讨之前，先来看看 React 官网 对 Hooks 做出的介绍：</p>
<blockquote>
<p>Hooks are a new feature proposal that lets you use state and other React features without writing a class. They’re currently in React v16.7.0-alpha and …</p>
</blockquote>
<h2 id="什么是-Hooks"><a href="#什么是-Hooks" class="headerlink" title="什么是 Hooks"></a>什么是 Hooks</h2><p>Hooks 是 React 函数组件内一类特殊的函数，通常以“use”开头，如“useState”、“useEffect”。Hooks 使得开发者能够在 function component 里继续使用 state 和 life-style，以及使用 custom hook 复用业务逻辑。“Hooks” 的本意是“钩子”，在 React 中，hooks 作为一系列特殊的函数，使函数式组件内部能够“钩住” React 内部的 state 和 life-style。</p>
<p>React Hooks API 向后兼容，它在解决了一些既有问题的情况下，不仅使开发者能够更好地使用 state 和 life-cycles，真正强大的功能点在于更加轻松地复用组件逻辑，也就是下文将要讲述的 custom hooks。</p>
<h2 id="Hooks-可以做什么"><a href="#Hooks-可以做什么" class="headerlink" title="Hooks 可以做什么"></a>Hooks 可以做什么</h2><p>React 中函数式组件是一个 pure render component，没有 state 和 component life-cycle。如果开发者需要使用 state 和 life-cycle，就需要将 function component 改写成 class component。在既有的 React API 下，这个模式有一些缺点：</p>
<ul>
<li><strong>组件间通信的耦合度高，组件树臃肿</strong><br>在既有的模式下，React 组件间通信有两种模式：</li>
</ul>
<ol>
<li>单向数据流</li>
<li>通过 Redux 的 global store 实现全局状态和各组件间的解耦</li>
</ol>
<p>当有些状态不适合放在 global store 中时，组件间逻辑的复用和通信就变得很困难（只能一层一层往下传）。这一点在高阶组件（HOC, Higher-Order Components）和渲染属性（Render Props）中更为常见。为了复用一些业务逻辑，有时候会单独编写一些高阶组件用来向下传递状态。这样就会导致当开发者的业务规模变得越来越庞大的时候，一些无关 UI 的 wrapper 组件越来越多，React 组件树就会变得愈加臃肿庞杂。例如，在有些时候，一个简单的 Tooltip component 里面都潜藏了很多层额外的组件，使得开发和调试的效率变得低下。</p>
<p>在新的 React Hook 中，开发者可以创建自定义 Hook（Custom Hook），用以复用一些逻辑，这些逻辑会成为一个独立的逻辑单元，不再出现在组件树中，但仍然能够响应 React 在渲染之间的变化。</p>
<ul>
<li><strong>由 js 的 class 带来的疑惑</strong></li>
</ul>
<p>简单来说，就是 js 语法中关于 this 的指向以及原型链、继承这类问题常常会给新手开发者学习 React 带来困惑。比如，在 React 组件内的事件监听之前需要手动绑定 this 的问题。</p>
<p>为了解决这些问题，Hooks 允许开发者在没有 class 的情况下使用 React 的 features。</p>
<p>总结来说，推出 Hooks 的动机是解决长时间使用和维护 react 过程中遇到的一些难以避免的问题，如：</p>
<ol>
<li>难以重用和共享组件中的与状态相关的逻辑</li>
<li>逻辑复杂的组件难以开发与维护，当我们的组件需要处理多个互不相关的 local state 时，每个生命周期函数中可能会包含着各种互不相关的逻辑在里面。</li>
<li>类组件中的 this 增加学习成本，类组件在基于现有工具的优化上存在些许问题。</li>
<li>由于业务变动，函数组件不得不改为类组件等等。</li>
</ol>
<h2 id="Hooks-的规则"><a href="#Hooks-的规则" class="headerlink" title="Hooks 的规则"></a>Hooks 的规则</h2><p>Hooks 仍然是 Javascript 函数，但是在使用时必须遵循两个常规 js 函数不具备的规则：</p>
<ul>
<li>只能在顶层调用 Hooks，不要在循环语句、条件判断或嵌套函数中调用 Hooks</li>
<li>仅从 React 函数式组件中调用 Hooks，不要从常规 js 函数中调用 Hooks</li>
<li>开发者也可以在 custom hooks 中调用 Hooks。</li>
</ul>
<p>遵循了上述规则之后，就能够确保每次组件渲染时都以相同的顺序调用 Hook。</p>
<p>为此，官方提供了一个名叫 <a href="https://www.npmjs.com/package/eslint-plugin-react-hooks" target="_blank" rel="noopener">eslint-plugin-react-hooks</a> 的 eslint 插件用来强制执行上述规则。</p>
<ol>
<li>将 eslint-plugin-react-hooks 安装到项目中：</li>
</ol>
<p><code>npm install eslint-plugin-react-hooks@next --save-dev</code></p>
<ol start="2">
<li>配置 eslint</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">  <span class="attr">"plugins"</span>: [</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">// ...</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="string">"react-hooks"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">  ],</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">  <span class="attr">"rules"</span>: &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">// ...</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    <span class="attr">"react-hooks/rules-of-hooks"</span>: <span class="string">"error"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">  &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<h2 id="Hooks-API"><a href="#Hooks-API" class="headerlink" title="Hooks API"></a>Hooks API</h2><p>由于 Hooks 是<strong>向后兼容</strong>（Backwards compatiblity, 也叫向下兼容）的，class component 不会被移除，向后兼容的友好性使得开发者可以将项目逐渐迁移到新的 Hooks API。</p>
<p>Hooks API 主要分为三种：</p>
<ol>
<li><strong>State hooks</strong>：在函数式组件中使用 state</li>
<li><strong>Effect hooks</strong>：在函数式组件中使用 life-cycle 和 side effect</li>
<li><strong>Custom hooks</strong>：用来复用组件逻辑，解决了上述动机中阐述的第一个问题</li>
</ol>
<ul>
<li><p><strong>State hooks</strong></p>
<p>看一个例子：</p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Example</span>(<span class="params"></span>) </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">  <span class="comment">// TODO 声明一个变量名为 count 的 state</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">  <span class="keyword">return</span> (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    &lt;div&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">      &lt;p&gt;You clicked &#123;count&#125; times&lt;<span class="regexp">/p&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">      &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;Click me&lt;/</span>button&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">    &lt;<span class="regexp">/div&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">  );</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">&#125;</span></span></pre></td></tr></table></figure>

<p>在这个例子中，“useState”就是一个 hook，通过它我们可以嵌入组件内部的 state，这个 useState 函数可以返回一个 pair 元组，其中第一个值是对应当前 hook 的 state 值，第二个是定义修改这个 state 的方法。</p>
<p>其实这个 pair 的两个返回值分别对应的就是 React 中 hooks 之前的 this.state、this.setState。</p>
<p>那么我们的组件中不可能只用到一个 state 和一个 setState，所以，useState 这个 hook 可以在一个函数组件中多次使用：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ExampleWithManyStates</span>(<span class="params"></span>) </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">  <span class="comment">// 声明多个state变量</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">  <span class="keyword">const</span> [age, setAge] = useState(<span class="number">28</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">  <span class="keyword">const</span> [fruit, setFruit] = useState(<span class="string">"apple"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">  <span class="keyword">const</span> [todos, setTodos] = useState([&#123; <span class="attr">text</span>: <span class="string">"React Hooks"</span> &#125;]);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">  <span class="comment">// ...</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>与以前在一个 class component 中只能写一个 state 相比，hooks 就避免了组件的 state 结构过于臃肿，每个 state 能够被单独处理。另外，useState 的写法可读性高，用户一眼就可以看出和 state 相关的两个变量，如上面例子中的[age, setAge]。</p>
<ul>
<li><strong>Effect hooks</strong></li>
<li></li>
</ul>
<p>首先了解下什么是 _Side Effect_（副作用），副作用是指函数或表达式的行为依赖于外部环境：</p>
<ul>
<li>函数或表达式修改了它的 scope 之外的状态</li>
<li>函数或表达式除了返回语句之外，还与外部环境或它所调用的函数有交互行为</li>
</ul>
<p>Effect hook 为函数式组件添加了执行 side effects 的能力。我们使用 useEffect 这个 API 来处理副作用：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Example</span>(<span class="params"></span>) </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">  <span class="comment">// 类似于 class component 中的 componentDidMount 和 componentDidUpdate:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">// 调用浏览器 API 更改文档标题 title</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    <span class="built_in">document</span>.title = <span class="string">`You clicked <span class="subst">$&#123;count&#125;</span> times`</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">  &#125;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">  <span class="keyword">return</span> (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">    &lt;div&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">      &lt;p&gt;You clicked &#123;count&#125; times&lt;<span class="regexp">/p&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">      &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;Click me&lt;/</span>button&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">    &lt;<span class="regexp">/div&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">  );</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">&#125;</span></span></pre></td></tr></table></figure>

<p>React Hooks 解决了在函数式组件中使用 life-cycle 的问题。useEffect Hook 可以看作是 React 类生命周期方法中 componentDidMount、componentDidUpdate 和 componentWillMount 的组合，这个钩子函数类似于 redux 中的 subscrib，每当 React 因为 state 或 props 改变重新 render 之后，就会触发 useEffect 里的回调函数。useEffect 的代码既会在初始化时执行，也会在后续每次 rerender 时执行。</p>
<ul>
<li><strong>Custom hooks</strong></li>
</ul>
<p>构建自定义钩子函数可以将组件逻辑提取到可重用组件中，即在 hooks 中引用其它 hooks。下面这个官方给出的 demo 演示了一个聊天程序中朋友是否处于在线状态：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// 底层 Hooks, 返回布尔值：是否在线</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useFriendStatusBoolean</span>(<span class="params">props</span>) </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">  <span class="keyword">const</span> [isOnline, setIsOnline] = useState(<span class="literal">null</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleStatusChange</span>(<span class="params">status</span>) </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    setIsOnline(status.isOnline);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">  &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">    ChatAPI.subscribeToFriendStatus(props.friendID, handleStatusChange);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">      ChatAPI.unsubscribeFromFriendStatus(friendID, handleStatusChange);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">    &#125;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">  &#125;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">  <span class="keyword">return</span> isOnline;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// 上层 Hooks，根据在线状态返回字符串：Loading... or Online or Offline</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useFriendStatusString</span>(<span class="params">props</span>) </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">  <span class="keyword">const</span> isOnline = useFriendStatusBoolean(props.friend.id);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">  <span class="keyword">if</span> (isOnline === <span class="literal">null</span>) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">return</span> <span class="string">"Loading..."</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line">  &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line">  <span class="keyword">return</span> isOnline ? <span class="string">"Online"</span> : <span class="string">"Offline"</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用了底层 Hooks 的 UI</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FriendListItem</span>(<span class="params">props</span>) </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line">  <span class="keyword">const</span> isOnline = useFriendStatusBoolean(props.friend.id);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">34</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">35</span></pre></td><td class="code"><pre><span class="line">  <span class="keyword">return</span> (</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">36</span></pre></td><td class="code"><pre><span class="line">    &lt;li style=&#123;&#123; <span class="attr">color</span>: isOnline ? <span class="string">"green"</span> : <span class="string">"black"</span> &#125;&#125;&gt;&#123;props.friend.name&#125;&lt;<span class="regexp">/li&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">37</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">  );</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">38</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">&#125;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">39</span></pre></td><td class="code"><pre><span class="line"><span class="regexp"></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">40</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">/</span><span class="regexp">/ 使用了上层 Hooks 的 UI</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">41</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">function FriendListStatus(props) &#123;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">42</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">  const statu = useFriendStatusString(props.friend.id);</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">43</span></pre></td><td class="code"><pre><span class="line"><span class="regexp"></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">44</span></pre></td><td class="code"><pre><span class="line"><span class="regexp">  return &lt;li&gt;&#123;statu&#125;&lt;/</span>li&gt;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">45</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>在这个例子中有两个 Hooks：<strong>useFriendStatusBoolean</strong> 与 <strong>useFriendStatusString</strong>，<strong>useFriendStatusString</strong> 是利用 <strong>useFriendStatusBoolean</strong> 生成的新 Hook，因为这两个 Hooks 的数据是联动的，所以可以提供给两个不同的 UI 组件使用：<strong>FriendListItem</strong> 与 <strong>FriendListStatus</strong>，两个 UI 组件的状态也将是联动的。</p>
<p>值得注意的是：</p>
<ol>
<li>这里，<strong>useFriendStatusBoolean 和 useFriendStatusString 是有状态组件</strong>（使用 useState），没有渲染，所以就可以作为 Custom Hooks 被任何 UI 组件所调用，实现了<strong>组件的复用</strong>。</li>
<li><strong>FriendListItem 和 FriendListStatus 是有渲染的组件</strong>（返回了 JSX），没有状态（没有使用 useState），所以他们就是一个纯 UI 组件。</li>
</ol>
<ul>
<li><strong>Other Built-in Hooks API</strong></li>
</ul>
<p>除了上述介绍的 useState、useEffect 之外，还有一些内置的其它 hooks，如：</p>
<ul>
<li>useContext：替代了&lt;Context.Consumer&gt;使用 render props 的写法，使组件树更加简洁。</li>
<li>useReducer：相当于组件自带的 redux reducer，负责接收 dipatch 分发的 action 并更新 state。</li>
<li>useCallback</li>
<li>……</li>
</ul>
<h2 id="Hooks-FAQ"><a href="#Hooks-FAQ" class="headerlink" title="Hooks FAQ"></a>Hooks FAQ</h2><p>参见官方文档针对 React Hooks 一些常见问题的解答：<br><a href="https://react.css88.com/docs/hooks-faq.html" target="_blank" rel="noopener">https://react.css88.com/docs/hooks-faq.html</a></p>
<h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><ol>
<li><a href="https://react.css88.com/docs/hooks-intro.html" target="_blank" rel="noopener">React 中文文档 - Hooks 概述</a></li>
<li><a href="https://react.css88.com/docs/hooks-faq.html" target="_blank" rel="noopener">Hooks FAQ</a></li>
<li><a href="https://juejin.im/post/5be8d3def265da611a476231" target="_blank" rel="noopener">精读《React Hooks》</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/50921147?utm_source=wechat_timeline&utm_medium=social&utm_oi=27826472353792&from=timeline&isappinstalled=0" target="_blank" rel="noopener">像呼吸一样自然：React Hooks + RxJS</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/48264713" target="_blank" rel="noopener">对 React Hooks 的一些思考</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/IMG_20190808_014018.jpg"
                alt="魏范光" />
            
              <p class="site-author-name" itemprop="name">魏范光</p>
              <p class="site-description motion-element" itemprop="description">我心思慕你，如鹿思慕溪</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%20%7C%7C%20archive">
              
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">魏范光</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
