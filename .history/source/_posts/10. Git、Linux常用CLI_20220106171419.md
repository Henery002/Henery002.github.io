---
title: Git/Linux常用CLI
date: 2020-02-28 10:00:00
updated: 2020-02-28 15:40:00
categories:
  - 原创
  - 技术栈
tags:
  - CLI
  - git
---

本篇内容主要是根据实际项目中的经验积累与总结，归纳在当前的前端工作场景中高频使用的 git cli 及 linux cli，便于加深记忆与熟练使用。

## 一、Git

梳理 git 操作中容易混淆和被忽视的几个概念：

**1. untracked flies**

git 系统中的文件具有生命周期，新添加到 git 仓库中的本地文件会被系统默认为未被追踪的文件。
![图片](../images/10-CLI/image.png)

删除无用的 `untracked files` 文件：

- git clean [-xndf]

**2. git stash**

- git stash list
- git stash pop [stash@{idx}]
- git stash drop [stash@{idx}]
- git stash clear

**3. git reset**

- 工作区、暂存区、版本库的关联性

![图片](../images/10-CLI/image-1.png)

- **reset [--soft|--hard|--mixed]**

![图片](../images/10-CLI/image-2.png)

- - git reset --soft HEAD^
    回滚到上一个提交，同时保留暂存区和工作目录的内容。

- - git reset [--mixed] HEAD^
    回滚到上一个提交，同时清空暂存区并保留工作目录的内容。

- - git reset --hard HEAD^
    回滚到上一个提交，同时清空暂存区和工作目录的所有改动。

【由此可推：当使用 git cherry-pick 后改动处于版本库（即 commit 之后）中，此时想要撤回 cherry-pick 即执行 git reset HEAD^ 即可。】

例：

当前 working directory 区状态（状态 1）：
![图片](../images/10-CLI/image-3.png)

当前 stage 区状态（状态 2）：
![图片](../images/10-CLI/image-4.png)

commit 后，head 区状态（状态 3）：
![图片](../images/10-CLI/image-5.png)

此时 HEAD^ 为当前 commit：
![图片](../images/10-CLI/image-6.png)

那么，--soft 模式将由状态 3 回到状态 2：
![图片](../images/10-CLI/image-7.png)

--mixed 模式将由状态 3 回到状态 1，对应的 HEAD 也将由 HEAD^变为 HEAD^^。
![图片](../images/10-CLI/image-8.png)

如果在执行一次 git reset --soft HEAD^ 之后在执行一次 git reset --soft HEAD^，则将回滚到 HEAD^^的提交状态，此时工作目录中的代码改动可能已经不是你自己所做的改动了。

这种情况下通过 git reset --hard HEAD^ 可以撤销当前工作目录和暂存区的改动，恢复异常状态，重新 pull。

## 二、Linux

以 linux 系统作为前端开发环境也是可选的工具技术栈。在 linux 开发环境下项目代码将部署在远程服务器上，开发人员可以直接读写远程服务器上的项目代码，执行同步、修改、部署（打包）等系列操作。**面向前端的** linux 常用 cli 并不多，根据开发过程中遇到的实际场景，整理归纳了部分命令行的使用注意点。

#### 1. 远程登录

- ssh
  linux 系统下通过 ssh 服务实现对远程服务器的连接。ssh 服务会把系统访问过的每一台计算机的公钥（public_key）记录下来（~/.ssh/known_hosts），以便再次访问该主机时进行核验，如 publick_key 不同，ssh 服务会发出警告（出于安全性考虑）。

![图片](../images/10-CLI/image-9.png)

#### 2. 文件/磁盘管理

##### a. 基本操作

- mkdir
- touch
- rm -rf /\*

##### b. 压缩备份

- tar [-cxzvf]
  -c # 建立压缩文件
  -x # 还原文件
  -z # 通过 gzip 指令处理压缩文件
  -v # 显示解压缩执行过程
  -f # 指定备份文件

  常用于对打包文件进行解压还原，或将日志文件进行打包输出。
  ![图片](../images/10-CLI/image-10.png)
  ![图片](../images/10-CLI/image-11.png)

##### c. 文件查找

- find

  1. 服务器端经常遇到磁盘被占满的情况，通常情况下由大的日志文件造成。
     查找大文件并删除：
     ![图片](../images/10-CLI/image-12.png)
  2. 模糊查询：
     ![图片](../images/10-CLI/image-13.png)

- grep [-r]
  查找文件中符合条件的字符串。
  如查找打包文件源代码中是否包含关键字（以排查代码提交是否正常）：

- whereis [-bm]
  查找二进制文件（应用程序）。
  如查找 yum 指令安装位置（及软连接、man 帮助手册）：
  ![图片](../images/10-CLI/image-14.png)

- locate # 查找文档（在/lib 数据库中查找）

##### d. 文件权限

- chmod [options] mode files
  文件的 9 种属性：
  [ d | r w x | r - x | r - x ]
  [ 文件类型 | 读 写 执行 | 读 写 执行 | 读 写 执行 ]
  [ | 4 2 1 | 4 2 1 | 4 2 1 ]
  [ | u(用户) | g(组) | o(其他) ]
  ![图片](../images/10-CLI/image-15.png)

  **参数：**
  mode: [ugoa][=+-][rwxX]，其中 r/w/x 权限分别通过数值 4/2/1 表示，因此权限又可以通过数值运算的值来表示。

  所以，可使用参数操作符修改文件权限。

  1. chmod 777 filename # => [drwxrwxrwx]
  2. chmod 445 filename # => [dr--r--r-x]
  3. chmod u=rw,g-w,o+wx # => [drw-r--rwx]
  4. chmod a-x filename # => [drw-rw-rw-]

##### e. 文件拷贝

- scp [-r]
  linux 系统下跨服务器文件拷贝，参数-r 可递归遍历文件夹里面的内容。

  1. 从远程服务器拷贝文件夹（文件）到本地主机
     ![图片](../images/10-CLI/image-16.png)

  2. 将本地主机文件夹（文件）拷贝到远程服务器
     ![图片](../images/10-CLI/image-17.png)

- rcp [-r]

##### f. 组合指令

- ls -a;pwd
- mkdir tempfile && cd tempfile

##### g. 定向输出

- find . -name _xplo_.js > mylog

#### 3. 网络系统

- **ping [-c] \<address>** # 测试本机与目标主机的连通性、稳定性
  ![图片](../images/10-CLI/image-18.png)

  其中：
  1: ping 目标主机域名(IP)
  2: 包文件大小
  3: ping 序列（参数-c 指定）
  4: 包文件收发数、丢包率
  5: 最小/平均/最大响应时间

  丢包率偏高连接不稳定的情况：

- **ifconfig** # 网络配置
  可通过参数配置，或编辑网络配置文件 /etc/sysconfig/network-script/ifcfg-ens0 修改。
  ![图片](../images/10-CLI/image-19.png)

  网络配置修改后，需要执行 service network restart 重启生效。

- **systemctl status \<servicename>** # 查看服务运行状态
  以 192.168.80.233 节点 danastudio 服务为例：
  ![图片](../images/10-CLI/image-20.png)

- **systemctl restart network** # 重启服务

#### 4. 创建别名

- **alias**
  使用 alias <shortname>=<command name> 定义一次性别名，仅供当前会话窗口使用。
  linux 下编辑 ~/.bashrc （macOS 下 ~/.bash_profile）保存别名设置，永久生效。
  ![图片](../images/10-CLI/image-21.png)

### 参考文章

1. [让你牛 B 加身的前端必会 Linux 命令](https://mp.weixin.qq.com/s?__biz=Mzg4MTYwMzY1Mw==&mid=2247496319&idx=1&sn=a9d8e79a0e679dedf80eccd53eacbc52&source=41#wechat_redirect) - 奇舞周刊
